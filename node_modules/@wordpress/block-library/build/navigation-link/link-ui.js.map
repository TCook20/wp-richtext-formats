{"version":3,"names":["_element","require","_dom","_components","_i18n","_blockEditor","_coreData","_htmlEntities","_blocks","_data","getSuggestionsQuery","type","kind","subtype","LinkControlTransforms","clientId","getBlock","blockTransforms","useSelect","select","_getBlock","getBlockRootClientId","getBlockTransformItems","blockEditorStore","replaceBlock","useDispatch","featuredBlocks","transforms","filter","item","includes","name","length","createElement","className","__","map","index","Button","key","onClick","switchToBlockType","BlockIcon","icon","title","LinkUI","props","saveEntityRecord","coreStore","pagesPermissions","useResourcePermissions","postsPermissions","handleCreate","pageTitle","postType","link","page","status","id","decodeEntities","rendered","url","label","opensInNewTab","userCanCreate","canCreate","useMemo","stripHTML","Popover","placement","onClose","anchor","shift","__experimentalLinkControl","hasTextControl","hasRichPreviews","value","showInitialSuggestions","withCreateSuggestion","createSuggestion","createSuggestionButtonText","searchTerm","format","createInterpolateElement","sprintf","mark","noDirectEntry","noURLSuggestion","suggestionsQuery","onChange","onRemove","onCancel","renderControlBottom"],"sources":["@wordpress/block-library/src/navigation-link/link-ui.js"],"sourcesContent":["/**\n * WordPress dependencies\n */\nimport { __unstableStripHTML as stripHTML } from '@wordpress/dom';\nimport { Popover, Button } from '@wordpress/components';\nimport { __, sprintf } from '@wordpress/i18n';\nimport {\n\t__experimentalLinkControl as LinkControl,\n\tBlockIcon,\n\tstore as blockEditorStore,\n} from '@wordpress/block-editor';\nimport { createInterpolateElement, useMemo } from '@wordpress/element';\nimport {\n\tstore as coreStore,\n\tuseResourcePermissions,\n} from '@wordpress/core-data';\nimport { decodeEntities } from '@wordpress/html-entities';\nimport { switchToBlockType } from '@wordpress/blocks';\nimport { useSelect, useDispatch } from '@wordpress/data';\n\n/**\n * Given the Link block's type attribute, return the query params to give to\n * /wp/v2/search.\n *\n * @param {string} type Link block's type attribute.\n * @param {string} kind Link block's entity of kind (post-type|taxonomy)\n * @return {{ type?: string, subtype?: string }} Search query params.\n */\nexport function getSuggestionsQuery( type, kind ) {\n\tswitch ( type ) {\n\t\tcase 'post':\n\t\tcase 'page':\n\t\t\treturn { type: 'post', subtype: type };\n\t\tcase 'category':\n\t\t\treturn { type: 'term', subtype: 'category' };\n\t\tcase 'tag':\n\t\t\treturn { type: 'term', subtype: 'post_tag' };\n\t\tcase 'post_format':\n\t\t\treturn { type: 'post-format' };\n\t\tdefault:\n\t\t\tif ( kind === 'taxonomy' ) {\n\t\t\t\treturn { type: 'term', subtype: type };\n\t\t\t}\n\t\t\tif ( kind === 'post-type' ) {\n\t\t\t\treturn { type: 'post', subtype: type };\n\t\t\t}\n\t\t\treturn {};\n\t}\n}\n\n/**\n * Add transforms to Link Control\n *\n * @param {Object} props          Component props.\n * @param {string} props.clientId Block client ID.\n */\nfunction LinkControlTransforms( { clientId } ) {\n\tconst { getBlock, blockTransforms } = useSelect(\n\t\t( select ) => {\n\t\t\tconst {\n\t\t\t\tgetBlock: _getBlock,\n\t\t\t\tgetBlockRootClientId,\n\t\t\t\tgetBlockTransformItems,\n\t\t\t} = select( blockEditorStore );\n\n\t\t\treturn {\n\t\t\t\tgetBlock: _getBlock,\n\t\t\t\tblockTransforms: getBlockTransformItems(\n\t\t\t\t\t_getBlock( clientId ),\n\t\t\t\t\tgetBlockRootClientId( clientId )\n\t\t\t\t),\n\t\t\t};\n\t\t},\n\t\t[ clientId ]\n\t);\n\n\tconst { replaceBlock } = useDispatch( blockEditorStore );\n\n\tconst featuredBlocks = [\n\t\t'core/page-list',\n\t\t'core/site-logo',\n\t\t'core/social-links',\n\t\t'core/search',\n\t];\n\n\tconst transforms = blockTransforms.filter( ( item ) => {\n\t\treturn featuredBlocks.includes( item.name );\n\t} );\n\n\tif ( ! transforms?.length ) {\n\t\treturn null;\n\t}\n\n\tif ( ! clientId ) {\n\t\treturn null;\n\t}\n\n\treturn (\n\t\t<div className=\"link-control-transform\">\n\t\t\t<h3 className=\"link-control-transform__subheading\">\n\t\t\t\t{ __( 'Transform' ) }\n\t\t\t</h3>\n\t\t\t<div className=\"link-control-transform__items\">\n\t\t\t\t{ transforms.map( ( item, index ) => {\n\t\t\t\t\treturn (\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\tkey={ `transform-${ index }` }\n\t\t\t\t\t\t\tonClick={ () =>\n\t\t\t\t\t\t\t\treplaceBlock(\n\t\t\t\t\t\t\t\t\tclientId,\n\t\t\t\t\t\t\t\t\tswitchToBlockType(\n\t\t\t\t\t\t\t\t\t\tgetBlock( clientId ),\n\t\t\t\t\t\t\t\t\t\titem.name\n\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tclassName=\"link-control-transform__item\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<BlockIcon icon={ item.icon } />\n\t\t\t\t\t\t\t{ item.title }\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t);\n\t\t\t\t} ) }\n\t\t\t</div>\n\t\t</div>\n\t);\n}\n\nexport function LinkUI( props ) {\n\tconst { saveEntityRecord } = useDispatch( coreStore );\n\tconst pagesPermissions = useResourcePermissions( 'pages' );\n\tconst postsPermissions = useResourcePermissions( 'posts' );\n\n\tasync function handleCreate( pageTitle ) {\n\t\tconst postType = props.link.type || 'page';\n\n\t\tconst page = await saveEntityRecord( 'postType', postType, {\n\t\t\ttitle: pageTitle,\n\t\t\tstatus: 'draft',\n\t\t} );\n\n\t\treturn {\n\t\t\tid: page.id,\n\t\t\ttype: postType,\n\t\t\t// Make `title` property consistent with that in `fetchLinkSuggestions` where the `rendered` title (containing HTML entities)\n\t\t\t// is also being decoded. By being consistent in both locations we avoid having to branch in the rendering output code.\n\t\t\t// Ideally in the future we will update both APIs to utilise the \"raw\" form of the title which is better suited to edit contexts.\n\t\t\t// e.g.\n\t\t\t// - title.raw = \"Yes & No\"\n\t\t\t// - title.rendered = \"Yes &#038; No\"\n\t\t\t// - decodeEntities( title.rendered ) = \"Yes & No\"\n\t\t\t// See:\n\t\t\t// - https://github.com/WordPress/gutenberg/pull/41063\n\t\t\t// - https://github.com/WordPress/gutenberg/blob/a1e1fdc0e6278457e9f4fc0b31ac6d2095f5450b/packages/core-data/src/fetch/__experimental-fetch-link-suggestions.js#L212-L218\n\t\t\ttitle: decodeEntities( page.title.rendered ),\n\t\t\turl: page.link,\n\t\t\tkind: 'post-type',\n\t\t};\n\t}\n\n\tconst { label, url, opensInNewTab, type, kind } = props.link;\n\n\tlet userCanCreate = false;\n\tif ( ! type || type === 'page' ) {\n\t\tuserCanCreate = pagesPermissions.canCreate;\n\t} else if ( type === 'post' ) {\n\t\tuserCanCreate = postsPermissions.canCreate;\n\t}\n\n\t// Memoize link value to avoid overriding the LinkControl's internal state.\n\t// This is a temporary fix. See https://github.com/WordPress/gutenberg/issues/50976#issuecomment-1568226407.\n\tconst link = useMemo(\n\t\t() => ( {\n\t\t\turl,\n\t\t\topensInNewTab,\n\t\t\ttitle: label && stripHTML( label ),\n\t\t} ),\n\t\t[ label, opensInNewTab, url ]\n\t);\n\n\treturn (\n\t\t<Popover\n\t\t\tplacement=\"bottom\"\n\t\t\tonClose={ props.onClose }\n\t\t\tanchor={ props.anchor }\n\t\t\tshift\n\t\t>\n\t\t\t<LinkControl\n\t\t\t\thasTextControl\n\t\t\t\thasRichPreviews\n\t\t\t\tvalue={ link }\n\t\t\t\tshowInitialSuggestions={ true }\n\t\t\t\twithCreateSuggestion={ userCanCreate }\n\t\t\t\tcreateSuggestion={ handleCreate }\n\t\t\t\tcreateSuggestionButtonText={ ( searchTerm ) => {\n\t\t\t\t\tlet format;\n\n\t\t\t\t\tif ( type === 'post' ) {\n\t\t\t\t\t\t/* translators: %s: search term. */\n\t\t\t\t\t\tformat = __( 'Create draft post: <mark>%s</mark>' );\n\t\t\t\t\t} else {\n\t\t\t\t\t\t/* translators: %s: search term. */\n\t\t\t\t\t\tformat = __( 'Create draft page: <mark>%s</mark>' );\n\t\t\t\t\t}\n\n\t\t\t\t\treturn createInterpolateElement(\n\t\t\t\t\t\tsprintf( format, searchTerm ),\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tmark: <mark />,\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t\t} }\n\t\t\t\tnoDirectEntry={ !! type }\n\t\t\t\tnoURLSuggestion={ !! type }\n\t\t\t\tsuggestionsQuery={ getSuggestionsQuery( type, kind ) }\n\t\t\t\tonChange={ props.onChange }\n\t\t\t\tonRemove={ props.onRemove }\n\t\t\t\tonCancel={ props.onCancel }\n\t\t\t\trenderControlBottom={\n\t\t\t\t\t! url\n\t\t\t\t\t\t? () => (\n\t\t\t\t\t\t\t\t<LinkControlTransforms\n\t\t\t\t\t\t\t\t\tclientId={ props.clientId }\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t  )\n\t\t\t\t\t\t: null\n\t\t\t\t}\n\t\t\t/>\n\t\t</Popover>\n\t);\n}\n"],"mappings":"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"}