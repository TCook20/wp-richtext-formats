{"version":3,"names":["expandedSearchBlock","hiddenClass","toggleAriaLabel","element","dataset","Error","ariaLabel","toggledAriaLabel","getSearchInput","block","querySelector","getSearchButton","handleKeydownEvent","event","key","collapseExpandedSearchBlock","focus","handleKeyupEvent","target","closest","expandSearchBlock","searchField","searchButton","type","ariaHidden","tabIndex","ariaExpanded","removeAttribute","classList","remove","document","addEventListener","passive","setAttribute","id","add","removeEventListener","HTMLFormElement","contains"],"sources":["@wordpress/block-library/src/search/view.js"],"sourcesContent":["/*eslint-env browser*/\n\n/** @type {?HTMLFormElement} */\nlet expandedSearchBlock = null;\n\nconst hiddenClass = 'wp-block-search__searchfield-hidden';\n\n/**\n * Toggles aria-label with data-toggled-aria-label.\n *\n * @param {HTMLElement} element\n */\nfunction toggleAriaLabel( element ) {\n\tif ( ! ( 'toggledAriaLabel' in element.dataset ) ) {\n\t\tthrow new Error( 'Element lacks toggledAriaLabel in dataset.' );\n\t}\n\n\tconst ariaLabel = element.dataset.toggledAriaLabel;\n\telement.dataset.toggledAriaLabel = element.ariaLabel;\n\telement.ariaLabel = ariaLabel;\n}\n\n/**\n * Gets search input.\n *\n * @param {HTMLFormElement} block Search block.\n * @return {HTMLInputElement} Search input.\n */\nfunction getSearchInput( block ) {\n\treturn block.querySelector( '.wp-block-search__input' );\n}\n\n/**\n * Gets search button.\n *\n * @param {HTMLFormElement} block Search block.\n * @return {HTMLButtonElement} Search button.\n */\nfunction getSearchButton( block ) {\n\treturn block.querySelector( '.wp-block-search__button' );\n}\n\n/**\n * Handles keydown event to collapse an expanded Search block (when pressing Escape key).\n *\n * @param {KeyboardEvent} event\n */\nfunction handleKeydownEvent( event ) {\n\tif ( ! expandedSearchBlock ) {\n\t\t// In case the event listener wasn't removed in time.\n\t\treturn;\n\t}\n\n\tif ( event.key === 'Escape' ) {\n\t\tconst block = expandedSearchBlock; // This is nullified by collapseExpandedSearchBlock().\n\t\tcollapseExpandedSearchBlock();\n\t\tgetSearchButton( block ).focus();\n\t}\n}\n\n/**\n * Handles keyup event to collapse an expanded Search block (e.g. when tabbing out of expanded Search block).\n *\n * @param {KeyboardEvent} event\n */\nfunction handleKeyupEvent( event ) {\n\tif ( ! expandedSearchBlock ) {\n\t\t// In case the event listener wasn't removed in time.\n\t\treturn;\n\t}\n\n\tif ( event.target.closest( '.wp-block-search' ) !== expandedSearchBlock ) {\n\t\tcollapseExpandedSearchBlock();\n\t}\n}\n\n/**\n * Expands search block.\n *\n * Inverse of what is done in collapseExpandedSearchBlock().\n *\n * @param {HTMLFormElement} block Search block.\n */\nfunction expandSearchBlock( block ) {\n\t// Make sure only one is open at a time.\n\tif ( expandedSearchBlock ) {\n\t\tcollapseExpandedSearchBlock();\n\t}\n\n\tconst searchField = getSearchInput( block );\n\tconst searchButton = getSearchButton( block );\n\n\tsearchButton.type = 'submit';\n\tsearchField.ariaHidden = 'false';\n\tsearchField.tabIndex = 0;\n\tsearchButton.ariaExpanded = 'true';\n\tsearchButton.removeAttribute( 'aria-controls' ); // Note: Seemingly not reflected with searchButton.ariaControls.\n\ttoggleAriaLabel( searchButton );\n\tblock.classList.remove( hiddenClass );\n\n\tsearchField.focus(); // Note that Chrome seems to do this automatically.\n\n\t// The following two must be inverse of what is done in collapseExpandedSearchBlock().\n\tdocument.addEventListener( 'keydown', handleKeydownEvent, {\n\t\tpassive: true,\n\t} );\n\tdocument.addEventListener( 'keyup', handleKeyupEvent, {\n\t\tpassive: true,\n\t} );\n\n\texpandedSearchBlock = block;\n}\n\n/**\n * Collapses the expanded search block.\n *\n * Inverse of what is done in expandSearchBlock().\n */\nfunction collapseExpandedSearchBlock() {\n\tif ( ! expandedSearchBlock ) {\n\t\tthrow new Error( 'Expected expandedSearchBlock to be defined.' );\n\t}\n\tconst block = expandedSearchBlock;\n\tconst searchField = getSearchInput( block );\n\tconst searchButton = getSearchButton( block );\n\n\tsearchButton.type = 'button';\n\tsearchField.ariaHidden = 'true';\n\tsearchField.tabIndex = -1;\n\tsearchButton.ariaExpanded = 'false';\n\tsearchButton.setAttribute( 'aria-controls', searchField.id ); // Note: Seemingly not reflected with searchButton.ariaControls.\n\ttoggleAriaLabel( searchButton );\n\tblock.classList.add( hiddenClass );\n\n\t// The following two must be inverse of what is done in expandSearchBlock().\n\tdocument.removeEventListener( 'keydown', handleKeydownEvent, {\n\t\tpassive: true,\n\t} );\n\tdocument.removeEventListener( 'keyup', handleKeyupEvent, {\n\t\tpassive: true,\n\t} );\n\n\texpandedSearchBlock = null;\n}\n\n// Listen for click events anywhere on the document so this script can be loaded asynchronously in the head.\ndocument.addEventListener(\n\t'click',\n\t( event ) => {\n\t\t// Get the ancestor expandable Search block of the clicked element.\n\t\tconst block = event.target.closest(\n\t\t\t'.wp-block-search__button-behavior-expand'\n\t\t);\n\n\t\t/*\n\t\t * If there is already an expanded search block and either the current click was not for a Search block or it was\n\t\t * for another block, then collapse the currently-expanded block.\n\t\t */\n\t\tif ( expandedSearchBlock && block !== expandedSearchBlock ) {\n\t\t\tcollapseExpandedSearchBlock();\n\t\t}\n\n\t\t// If the click was on or inside a collapsed Search block, expand it.\n\t\tif (\n\t\t\tblock instanceof HTMLFormElement &&\n\t\t\tblock.classList.contains( hiddenClass )\n\t\t) {\n\t\t\texpandSearchBlock( block );\n\t\t}\n\t},\n\t{ passive: true }\n);\n"],"mappings":"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"}