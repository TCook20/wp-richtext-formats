{"version":3,"names":["_element","require","_util","_dedupe","_interopRequireDefault","_i18n","_components","_blockEditor","_blocks","_wpEmbedPreview","EmbedPreview","Component","constructor","arguments","hideOverlay","bind","state","interactive","getDerivedStateFromProps","nextProps","isSelected","setState","render","preview","previewable","url","type","caption","onCaptionChange","className","icon","label","insertBlocksAfter","props","scripts","html","getPhotoHtml","parsedHost","URL","host","split","parsedHostBaseUrl","splice","length","join","iframeTitle","sprintf","__","sandboxClassnames","classnames","embedWrapper","createElement","default","SandBox","title","onFocus","onMouseUp","Placeholder","BlockIcon","showColors","href","RichText","isEmpty","identifier","tagName","__experimentalGetElementClassName","placeholder","value","onChange","inlineToolbar","__unstableOnSplitAtEnd","createBlock","getDefaultBlockName","_default","exports"],"sources":["@wordpress/block-library/src/embed/embed-preview.js"],"sourcesContent":["/**\n * Internal dependencies\n */\nimport { getPhotoHtml } from './util';\n\n/**\n * External dependencies\n */\nimport classnames from 'classnames/dedupe';\n\n/**\n * WordPress dependencies\n */\nimport { __, sprintf } from '@wordpress/i18n';\nimport { Placeholder, SandBox } from '@wordpress/components';\nimport {\n\tRichText,\n\tBlockIcon,\n\t__experimentalGetElementClassName,\n} from '@wordpress/block-editor';\nimport { Component } from '@wordpress/element';\nimport { createBlock, getDefaultBlockName } from '@wordpress/blocks';\n\n/**\n * Internal dependencies\n */\nimport WpEmbedPreview from './wp-embed-preview';\n\nclass EmbedPreview extends Component {\n\tconstructor() {\n\t\tsuper( ...arguments );\n\t\tthis.hideOverlay = this.hideOverlay.bind( this );\n\t\tthis.state = {\n\t\t\tinteractive: false,\n\t\t};\n\t}\n\n\tstatic getDerivedStateFromProps( nextProps, state ) {\n\t\tif ( ! nextProps.isSelected && state.interactive ) {\n\t\t\t// We only want to change this when the block is not selected, because changing it when\n\t\t\t// the block becomes selected makes the overlap disappear too early. Hiding the overlay\n\t\t\t// happens on mouseup when the overlay is clicked.\n\t\t\treturn { interactive: false };\n\t\t}\n\n\t\treturn null;\n\t}\n\n\thideOverlay() {\n\t\t// This is called onMouseUp on the overlay. We can't respond to the `isSelected` prop\n\t\t// changing, because that happens on mouse down, and the overlay immediately disappears,\n\t\t// and the mouse event can end up in the preview content. We can't use onClick on\n\t\t// the overlay to hide it either, because then the editor misses the mouseup event, and\n\t\t// thinks we're multi-selecting blocks.\n\t\tthis.setState( { interactive: true } );\n\t}\n\n\trender() {\n\t\tconst {\n\t\t\tpreview,\n\t\t\tpreviewable,\n\t\t\turl,\n\t\t\ttype,\n\t\t\tcaption,\n\t\t\tonCaptionChange,\n\t\t\tisSelected,\n\t\t\tclassName,\n\t\t\ticon,\n\t\t\tlabel,\n\t\t\tinsertBlocksAfter,\n\t\t} = this.props;\n\t\tconst { scripts } = preview;\n\t\tconst { interactive } = this.state;\n\n\t\tconst html = 'photo' === type ? getPhotoHtml( preview ) : preview.html;\n\t\tconst parsedHost = new URL( url ).host.split( '.' );\n\t\tconst parsedHostBaseUrl = parsedHost\n\t\t\t.splice( parsedHost.length - 2, parsedHost.length - 1 )\n\t\t\t.join( '.' );\n\t\tconst iframeTitle = sprintf(\n\t\t\t// translators: %s: host providing embed content e.g: www.youtube.com\n\t\t\t__( 'Embedded content from %s' ),\n\t\t\tparsedHostBaseUrl\n\t\t);\n\t\tconst sandboxClassnames = classnames(\n\t\t\ttype,\n\t\t\tclassName,\n\t\t\t'wp-block-embed__wrapper'\n\t\t);\n\n\t\t// Disabled because the overlay div doesn't actually have a role or functionality\n\t\t// as far as the user is concerned. We're just catching the first click so that\n\t\t// the block can be selected without interacting with the embed preview that the overlay covers.\n\t\t/* eslint-disable jsx-a11y/no-static-element-interactions */\n\t\tconst embedWrapper =\n\t\t\t'wp-embed' === type ? (\n\t\t\t\t<WpEmbedPreview html={ html } />\n\t\t\t) : (\n\t\t\t\t<div className=\"wp-block-embed__wrapper\">\n\t\t\t\t\t<SandBox\n\t\t\t\t\t\thtml={ html }\n\t\t\t\t\t\tscripts={ scripts }\n\t\t\t\t\t\ttitle={ iframeTitle }\n\t\t\t\t\t\ttype={ sandboxClassnames }\n\t\t\t\t\t\tonFocus={ this.hideOverlay }\n\t\t\t\t\t/>\n\t\t\t\t\t{ ! interactive && (\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclassName=\"block-library-embed__interactive-overlay\"\n\t\t\t\t\t\t\tonMouseUp={ this.hideOverlay }\n\t\t\t\t\t\t/>\n\t\t\t\t\t) }\n\t\t\t\t</div>\n\t\t\t);\n\t\t/* eslint-enable jsx-a11y/no-static-element-interactions */\n\n\t\treturn (\n\t\t\t<figure\n\t\t\t\tclassName={ classnames( className, 'wp-block-embed', {\n\t\t\t\t\t'is-type-video': 'video' === type,\n\t\t\t\t} ) }\n\t\t\t>\n\t\t\t\t{ previewable ? (\n\t\t\t\t\tembedWrapper\n\t\t\t\t) : (\n\t\t\t\t\t<Placeholder\n\t\t\t\t\t\ticon={ <BlockIcon icon={ icon } showColors /> }\n\t\t\t\t\t\tlabel={ label }\n\t\t\t\t\t>\n\t\t\t\t\t\t<p className=\"components-placeholder__error\">\n\t\t\t\t\t\t\t<a href={ url }>{ url }</a>\n\t\t\t\t\t\t</p>\n\t\t\t\t\t\t<p className=\"components-placeholder__error\">\n\t\t\t\t\t\t\t{ sprintf(\n\t\t\t\t\t\t\t\t/* translators: %s: host providing embed content e.g: www.youtube.com */\n\t\t\t\t\t\t\t\t__(\n\t\t\t\t\t\t\t\t\t\"Embedded content from %s can't be previewed in the editor.\"\n\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t\tparsedHostBaseUrl\n\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t</p>\n\t\t\t\t\t</Placeholder>\n\t\t\t\t) }\n\t\t\t\t{ ( ! RichText.isEmpty( caption ) || isSelected ) && (\n\t\t\t\t\t<RichText\n\t\t\t\t\t\tidentifier=\"caption\"\n\t\t\t\t\t\ttagName=\"figcaption\"\n\t\t\t\t\t\tclassName={ __experimentalGetElementClassName(\n\t\t\t\t\t\t\t'caption'\n\t\t\t\t\t\t) }\n\t\t\t\t\t\tplaceholder={ __( 'Add caption' ) }\n\t\t\t\t\t\tvalue={ caption }\n\t\t\t\t\t\tonChange={ onCaptionChange }\n\t\t\t\t\t\tinlineToolbar\n\t\t\t\t\t\t__unstableOnSplitAtEnd={ () =>\n\t\t\t\t\t\t\tinsertBlocksAfter(\n\t\t\t\t\t\t\t\tcreateBlock( getDefaultBlockName() )\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t}\n\t\t\t\t\t/>\n\t\t\t\t) }\n\t\t\t</figure>\n\t\t);\n\t}\n}\n\nexport default EmbedPreview;\n"],"mappings":"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"}