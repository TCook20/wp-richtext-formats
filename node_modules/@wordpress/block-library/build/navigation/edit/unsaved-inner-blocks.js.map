{"version":3,"names":["_element","require","_blockEditor","_components","_coreData","_data","_areBlocksDirty","_constants","EMPTY_OBJECT","UnsavedInnerBlocks","blocks","createNavigationMenu","hasSelection","originalBlocks","useRef","useEffect","current","innerBlocksAreDirty","areBlocksDirty","shouldDirectInsert","useMemo","every","name","isDisabled","useContext","Disabled","Context","innerBlocksProps","useInnerBlocksProps","className","renderAppender","undefined","allowedBlocks","ALLOWED_BLOCKS","defaultBlock","DEFAULT_BLOCK","directInsert","isSaving","hasResolvedAllNavigationMenus","useSelect","select","hasFinishedResolution","isSavingEntityRecord","coreStore","SELECT_NAVIGATION_MENUS_ARGS","Wrapper","createElement"],"sources":["@wordpress/block-library/src/navigation/edit/unsaved-inner-blocks.js"],"sourcesContent":["/**\n * WordPress dependencies\n */\nimport { useInnerBlocksProps } from '@wordpress/block-editor';\nimport { Disabled } from '@wordpress/components';\nimport { store as coreStore } from '@wordpress/core-data';\nimport { useSelect } from '@wordpress/data';\nimport { useContext, useEffect, useRef, useMemo } from '@wordpress/element';\n\n/**\n * Internal dependencies\n */\nimport { areBlocksDirty } from './are-blocks-dirty';\nimport {\n\tDEFAULT_BLOCK,\n\tALLOWED_BLOCKS,\n\tSELECT_NAVIGATION_MENUS_ARGS,\n} from '../constants';\n\nconst EMPTY_OBJECT = {};\n\nexport default function UnsavedInnerBlocks( {\n\tblocks,\n\tcreateNavigationMenu,\n\thasSelection,\n} ) {\n\tconst originalBlocks = useRef();\n\n\tuseEffect( () => {\n\t\t// Initially store the uncontrolled inner blocks for\n\t\t// dirty state comparison.\n\t\tif ( ! originalBlocks?.current ) {\n\t\t\toriginalBlocks.current = blocks;\n\t\t}\n\t}, [ blocks ] );\n\n\t// If the current inner blocks are different from the original inner blocks\n\t// from the post content then the user has made changes to the inner blocks.\n\t// At this point the inner blocks can be considered \"dirty\".\n\t// Note: referential equality is not sufficient for comparison as the inner blocks\n\t// of the page list are controlled and may be updated async due to syncing with\n\t// entity records. As a result we need to perform a deep equality check skipping\n\t// the page list's inner blocks.\n\tconst innerBlocksAreDirty = areBlocksDirty(\n\t\toriginalBlocks?.current,\n\t\tblocks\n\t);\n\n\tconst shouldDirectInsert = useMemo(\n\t\t() =>\n\t\t\tblocks.every(\n\t\t\t\t( { name } ) =>\n\t\t\t\t\tname === 'core/navigation-link' ||\n\t\t\t\t\tname === 'core/navigation-submenu' ||\n\t\t\t\t\tname === 'core/page-list'\n\t\t\t),\n\t\t[ blocks ]\n\t);\n\n\t// The block will be disabled in a block preview, use this as a way of\n\t// avoiding the side-effects of this component for block previews.\n\tconst isDisabled = useContext( Disabled.Context );\n\n\tconst innerBlocksProps = useInnerBlocksProps(\n\t\t{\n\t\t\tclassName: 'wp-block-navigation__container',\n\t\t},\n\t\t{\n\t\t\trenderAppender: hasSelection ? undefined : false,\n\t\t\tallowedBlocks: ALLOWED_BLOCKS,\n\t\t\tdefaultBlock: DEFAULT_BLOCK,\n\t\t\tdirectInsert: shouldDirectInsert,\n\t\t}\n\t);\n\n\tconst { isSaving, hasResolvedAllNavigationMenus } = useSelect(\n\t\t( select ) => {\n\t\t\tif ( isDisabled ) {\n\t\t\t\treturn EMPTY_OBJECT;\n\t\t\t}\n\n\t\t\tconst { hasFinishedResolution, isSavingEntityRecord } =\n\t\t\t\tselect( coreStore );\n\n\t\t\treturn {\n\t\t\t\tisSaving: isSavingEntityRecord( 'postType', 'wp_navigation' ),\n\t\t\t\thasResolvedAllNavigationMenus: hasFinishedResolution(\n\t\t\t\t\t'getEntityRecords',\n\t\t\t\t\tSELECT_NAVIGATION_MENUS_ARGS\n\t\t\t\t),\n\t\t\t};\n\t\t},\n\t\t[ isDisabled ]\n\t);\n\n\t// Automatically save the uncontrolled blocks.\n\tuseEffect( () => {\n\t\t// The block will be disabled when used in a BlockPreview.\n\t\t// In this case avoid automatic creation of a wp_navigation post.\n\t\t// Otherwise the user will be spammed with lots of menus!\n\t\t//\n\t\t// Also ensure other navigation menus have loaded so an\n\t\t// accurate name can be created.\n\t\t//\n\t\t// Don't try saving when another save is already\n\t\t// in progress.\n\t\t//\n\t\t// And finally only create the menu when the block is selected,\n\t\t// which is an indication they want to start editing.\n\t\tif (\n\t\t\tisDisabled ||\n\t\t\tisSaving ||\n\t\t\t! hasResolvedAllNavigationMenus ||\n\t\t\t! hasSelection ||\n\t\t\t! innerBlocksAreDirty\n\t\t) {\n\t\t\treturn;\n\t\t}\n\n\t\tcreateNavigationMenu( null, blocks );\n\t}, [\n\t\tblocks,\n\t\tcreateNavigationMenu,\n\t\tisDisabled,\n\t\tisSaving,\n\t\thasResolvedAllNavigationMenus,\n\t\tinnerBlocksAreDirty,\n\t\thasSelection,\n\t] );\n\n\tconst Wrapper = isSaving ? Disabled : 'div';\n\n\treturn <Wrapper { ...innerBlocksProps } />;\n}\n"],"mappings":";;;;;;AAOA,IAAAA,QAAA,GAAAC,OAAA;AAJA,IAAAC,YAAA,GAAAD,OAAA;AACA,IAAAE,WAAA,GAAAF,OAAA;AACA,IAAAG,SAAA,GAAAH,OAAA;AACA,IAAAI,KAAA,GAAAJ,OAAA;AAMA,IAAAK,eAAA,GAAAL,OAAA;AACA,IAAAM,UAAA,GAAAN,OAAA;AAbA;AACA;AACA;;AAOA;AACA;AACA;;AAQA,MAAMO,YAAY,GAAG,CAAC,CAAC;AAER,SAASC,kBAAkBA,CAAE;EAC3CC,MAAM;EACNC,oBAAoB;EACpBC;AACD,CAAC,EAAG;EACH,MAAMC,cAAc,GAAG,IAAAC,eAAM,EAAC,CAAC;EAE/B,IAAAC,kBAAS,EAAE,MAAM;IAChB;IACA;IACA,IAAK,CAAEF,cAAc,EAAEG,OAAO,EAAG;MAChCH,cAAc,CAACG,OAAO,GAAGN,MAAM;IAChC;EACD,CAAC,EAAE,CAAEA,MAAM,CAAG,CAAC;;EAEf;EACA;EACA;EACA;EACA;EACA;EACA;EACA,MAAMO,mBAAmB,GAAG,IAAAC,8BAAc,EACzCL,cAAc,EAAEG,OAAO,EACvBN,MACD,CAAC;EAED,MAAMS,kBAAkB,GAAG,IAAAC,gBAAO,EACjC,MACCV,MAAM,CAACW,KAAK,CACX,CAAE;IAAEC;EAAK,CAAC,KACTA,IAAI,KAAK,sBAAsB,IAC/BA,IAAI,KAAK,yBAAyB,IAClCA,IAAI,KAAK,gBACX,CAAC,EACF,CAAEZ,MAAM,CACT,CAAC;;EAED;EACA;EACA,MAAMa,UAAU,GAAG,IAAAC,mBAAU,EAAEC,oBAAQ,CAACC,OAAQ,CAAC;EAEjD,MAAMC,gBAAgB,GAAG,IAAAC,gCAAmB,EAC3C;IACCC,SAAS,EAAE;EACZ,CAAC,EACD;IACCC,cAAc,EAAElB,YAAY,GAAGmB,SAAS,GAAG,KAAK;IAChDC,aAAa,EAAEC,yBAAc;IAC7BC,YAAY,EAAEC,wBAAa;IAC3BC,YAAY,EAAEjB;EACf,CACD,CAAC;EAED,MAAM;IAAEkB,QAAQ;IAAEC;EAA8B,CAAC,GAAG,IAAAC,eAAS,EAC1DC,MAAM,IAAM;IACb,IAAKjB,UAAU,EAAG;MACjB,OAAOf,YAAY;IACpB;IAEA,MAAM;MAAEiC,qBAAqB;MAAEC;IAAqB,CAAC,GACpDF,MAAM,CAAEG,eAAU,CAAC;IAEpB,OAAO;MACNN,QAAQ,EAAEK,oBAAoB,CAAE,UAAU,EAAE,eAAgB,CAAC;MAC7DJ,6BAA6B,EAAEG,qBAAqB,CACnD,kBAAkB,EAClBG,uCACD;IACD,CAAC;EACF,CAAC,EACD,CAAErB,UAAU,CACb,CAAC;;EAED;EACA,IAAAR,kBAAS,EAAE,MAAM;IAChB;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA,IACCQ,UAAU,IACVc,QAAQ,IACR,CAAEC,6BAA6B,IAC/B,CAAE1B,YAAY,IACd,CAAEK,mBAAmB,EACpB;MACD;IACD;IAEAN,oBAAoB,CAAE,IAAI,EAAED,MAAO,CAAC;EACrC,CAAC,EAAE,CACFA,MAAM,EACNC,oBAAoB,EACpBY,UAAU,EACVc,QAAQ,EACRC,6BAA6B,EAC7BrB,mBAAmB,EACnBL,YAAY,CACX,CAAC;EAEH,MAAMiC,OAAO,GAAGR,QAAQ,GAAGZ,oBAAQ,GAAG,KAAK;EAE3C,OAAO,IAAAzB,QAAA,CAAA8C,aAAA,EAACD,OAAO;IAAA,GAAMlB;EAAgB,CAAI,CAAC;AAC3C"}