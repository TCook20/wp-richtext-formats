{"version":3,"names":["ActivityIndicator","Image","RNImage","TouchableWithoutFeedback","View","useRoute","Component","useEffect","requestMediaImport","mediaUploadSync","requestImageFailedRetryDialog","requestImageUploadCancelDialog","requestImageFullscreenPreview","setFeaturedImage","Icon","PanelBody","ToolbarButton","ToolbarGroup","WIDE_ALIGNMENTS","LinkSettingsNavigation","BottomSheet","BottomSheetTextControl","BottomSheetSelectControl","FooterMessageControl","FooterMessageLink","Badge","BlockCaption","MediaPlaceholder","MediaUpload","MediaUploadProgress","MEDIA_TYPE_IMAGE","BlockControls","InspectorControls","BlockAlignmentToolbar","BlockStyles","store","blockEditorStore","blockSettingsScreens","__","_x","sprintf","getProtocol","hasQueryArg","isURL","doAction","hasAction","compose","withPreferredColorScheme","withSelect","withDispatch","image","placeholderIcon","replace","fullscreen","textColor","coreStore","noticesStore","editPostStore","styles","getUpdatedLinkTargetSettings","LINK_DESTINATION_NONE","LINK_DESTINATION_CUSTOM","LINK_DESTINATION_ATTACHMENT","LINK_DESTINATION_MEDIA","MEDIA_ID_NO_FEATURED_IMAGE_SET","getUrlForSlug","sizeSlug","undefined","media_details","sizes","source_url","LinkSettings","attributes","isLinkSheetVisible","setMappedAttributes","route","href","url","label","linkDestination","linkTarget","rel","inputValue","newUrl","params","newLinkDestination","link","valueMask","linkSettingsOptions","autoFocus","autoFill","openInNewTab","linkRel","placeholder","createElement","title","isVisible","setAttributes","withBottomSheet","hasPicker","options","showIcon","onLinkCellPressed","navigation","navigate","imageLinkDestinations","imageUrl","attachmentPageUrl","UPLOAD_STATE_IDLE","UPLOAD_STATE_UPLOADING","UPLOAD_STATE_SUCCEEDED","UPLOAD_STATE_FAILED","ImageEdit","constructor","props","state","isCaptionSelected","uploadStatus","replacedFeaturedImage","finishMediaUploadWithSuccess","bind","finishMediaUploadWithFailure","mediaUploadStateReset","onSelectMediaUploadOption","updateMediaProgress","updateImageURL","onSetNewTab","onSetSizeSlug","onImagePressed","onSetFeatured","onFocusCaption","onSelectURL","updateAlignment","accessibilityLabelCreator","onSizeChangeValue","componentDidMount","id","console","warn","componentWillUnmount","componentDidUpdate","previousProps","featuredImageId","updatedUrl","previousId","canImageBeFeatured","getDerivedStateFromProps","isSelected","caption","trim","length","setState","payload","mediaUrl","mediaServerId","mediaId","width","height","nextAlign","extraUpdatedAttributes","Object","values","alignments","includes","align","value","updatedLinkTarget","media","imageDefaultSize","destination","mediaAttributes","alt","additionalAttributes","newURL","createErrorNotice","isFetchingImage","getSize","onFocus","getPlaceholderIcon","icon","getStylesFromColorScheme","iconPlaceholder","iconPlaceholderDark","showLoadingIndicator","style","image__loading","animating","getWidth","restAttributes","getAltTextSettings","updateAlt","newAlt","initialValue","onChange","footerNote","Fragment","newValue","closeSettingsBottomSheet","getFeaturedButtonPanel","isFeaturedImage","setFeaturedButtonStyle","setFeaturedButton","setFeaturedButtonDark","removeFeaturedButton","Cell","labelStyle","cellContainerStyle","setFeaturedButtonCellContainer","separatorType","onPress","isGif","toLowerCase","render","clientId","context","wasBlockJustInserted","shouldUseFastImage","className","hasImageContext","keys","imageSizes","Array","isArray","sizeOptions","filter","slug","map","name","selectedSizeOption","sizeOptionsValid","find","option","getToolbarEditButton","open","onClick","getInspectorControls","panelBody","titleStyle","featuredImagePanelTitle","content","allowedTypes","onSelect","autoOpenMediaUpload","alignToFlex","left","center","right","full","wide","additionalImageProps","resizeMode","imageCrop","imageContainerStyles","fixedHeight","badgeLabelShown","badgeLabelText","getImageComponent","openMediaOptions","getMediaOptions","show","accessible","disabled","coverUrl","onUpdateMediaProgress","onFinishMediaUploadWithSuccess","onFinishMediaUploadWithFailure","onMediaUploadStateReset","renderContent","isUploadInProgress","isUploadFailed","retryMessage","shapeStyle","onBlur","insertBlocksAfter","isReplacingMedia","select","getMedia","getSettings","getEditedPostAttribute","capabilities","isNotFileUrl","shouldGetMedia","dispatch","closeGeneralSidebar"],"sources":["@wordpress/block-library/src/image/edit.native.js"],"sourcesContent":["/**\n * External dependencies\n */\nimport {\n\tActivityIndicator,\n\tImage as RNImage,\n\tTouchableWithoutFeedback,\n\tView,\n} from 'react-native';\nimport { useRoute } from '@react-navigation/native';\n\n/**\n * WordPress dependencies\n */\nimport { Component, useEffect } from '@wordpress/element';\nimport {\n\trequestMediaImport,\n\tmediaUploadSync,\n\trequestImageFailedRetryDialog,\n\trequestImageUploadCancelDialog,\n\trequestImageFullscreenPreview,\n\tsetFeaturedImage,\n} from '@wordpress/react-native-bridge';\nimport {\n\tIcon,\n\tPanelBody,\n\tToolbarButton,\n\tToolbarGroup,\n\tImage,\n\tWIDE_ALIGNMENTS,\n\tLinkSettingsNavigation,\n\tBottomSheet,\n\tBottomSheetTextControl,\n\tBottomSheetSelectControl,\n\tFooterMessageControl,\n\tFooterMessageLink,\n\tBadge,\n} from '@wordpress/components';\nimport {\n\tBlockCaption,\n\tMediaPlaceholder,\n\tMediaUpload,\n\tMediaUploadProgress,\n\tMEDIA_TYPE_IMAGE,\n\tBlockControls,\n\tInspectorControls,\n\tBlockAlignmentToolbar,\n\tBlockStyles,\n\tstore as blockEditorStore,\n\tblockSettingsScreens,\n} from '@wordpress/block-editor';\nimport { __, _x, sprintf } from '@wordpress/i18n';\nimport { getProtocol, hasQueryArg, isURL } from '@wordpress/url';\nimport { doAction, hasAction } from '@wordpress/hooks';\nimport { compose, withPreferredColorScheme } from '@wordpress/compose';\nimport { withSelect, withDispatch } from '@wordpress/data';\nimport {\n\timage as placeholderIcon,\n\treplace,\n\tfullscreen,\n\ttextColor,\n} from '@wordpress/icons';\nimport { store as coreStore } from '@wordpress/core-data';\nimport { store as noticesStore } from '@wordpress/notices';\n// eslint-disable-next-line no-restricted-imports\nimport { store as editPostStore } from '@wordpress/edit-post';\n\n/**\n * Internal dependencies\n */\nimport styles from './styles.scss';\nimport { getUpdatedLinkTargetSettings } from './utils';\n\nimport {\n\tLINK_DESTINATION_NONE,\n\tLINK_DESTINATION_CUSTOM,\n\tLINK_DESTINATION_ATTACHMENT,\n\tLINK_DESTINATION_MEDIA,\n\tMEDIA_ID_NO_FEATURED_IMAGE_SET,\n} from './constants';\n\nconst getUrlForSlug = ( image, sizeSlug ) => {\n\tif ( ! sizeSlug ) {\n\t\treturn undefined;\n\t}\n\treturn image?.media_details?.sizes?.[ sizeSlug ]?.source_url;\n};\n\nfunction LinkSettings( {\n\tattributes,\n\timage,\n\tisLinkSheetVisible,\n\tsetMappedAttributes,\n} ) {\n\tconst route = useRoute();\n\tconst { href: url, label, linkDestination, linkTarget, rel } = attributes;\n\n\t// Persist attributes passed from child screen.\n\tuseEffect( () => {\n\t\tconst { inputValue: newUrl } = route.params || {};\n\n\t\tlet newLinkDestination;\n\t\tswitch ( newUrl ) {\n\t\t\tcase attributes.url:\n\t\t\t\tnewLinkDestination = LINK_DESTINATION_MEDIA;\n\t\t\t\tbreak;\n\t\t\tcase image?.link:\n\t\t\t\tnewLinkDestination = LINK_DESTINATION_ATTACHMENT;\n\t\t\t\tbreak;\n\t\t\tcase '':\n\t\t\t\tnewLinkDestination = LINK_DESTINATION_NONE;\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tnewLinkDestination = LINK_DESTINATION_CUSTOM;\n\t\t\t\tbreak;\n\t\t}\n\n\t\tsetMappedAttributes( {\n\t\t\turl: newUrl,\n\t\t\tlinkDestination: newLinkDestination,\n\t\t} );\n\t}, [ route.params?.inputValue ] );\n\n\tlet valueMask;\n\tswitch ( linkDestination ) {\n\t\tcase LINK_DESTINATION_MEDIA:\n\t\t\tvalueMask = __( 'Media File' );\n\t\t\tbreak;\n\t\tcase LINK_DESTINATION_ATTACHMENT:\n\t\t\tvalueMask = __( 'Attachment Page' );\n\t\t\tbreak;\n\t\tcase LINK_DESTINATION_CUSTOM:\n\t\t\tvalueMask = __( 'Custom URL' );\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tvalueMask = __( 'None' );\n\t\t\tbreak;\n\t}\n\n\tconst linkSettingsOptions = {\n\t\turl: {\n\t\t\tvalueMask,\n\t\t\tautoFocus: false,\n\t\t\tautoFill: false,\n\t\t},\n\t\topenInNewTab: {\n\t\t\tlabel: __( 'Open in new tab' ),\n\t\t},\n\t\tlinkRel: {\n\t\t\tlabel: __( 'Link Rel' ),\n\t\t\tplaceholder: _x( 'None', 'Link rel attribute value placeholder' ),\n\t\t},\n\t};\n\n\treturn (\n\t\t<PanelBody title={ __( 'Link Settings' ) }>\n\t\t\t<LinkSettingsNavigation\n\t\t\t\tisVisible={ isLinkSheetVisible }\n\t\t\t\turl={ url }\n\t\t\t\trel={ rel }\n\t\t\t\tlabel={ label }\n\t\t\t\tlinkTarget={ linkTarget }\n\t\t\t\tsetAttributes={ setMappedAttributes }\n\t\t\t\twithBottomSheet={ false }\n\t\t\t\thasPicker\n\t\t\t\toptions={ linkSettingsOptions }\n\t\t\t\tshowIcon={ false }\n\t\t\t\tonLinkCellPressed={ ( { navigation } ) => {\n\t\t\t\t\tnavigation.navigate(\n\t\t\t\t\t\tblockSettingsScreens.imageLinkDestinations,\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tinputValue: attributes.href,\n\t\t\t\t\t\t\tlinkDestination: attributes.linkDestination,\n\t\t\t\t\t\t\timageUrl: attributes.url,\n\t\t\t\t\t\t\tattachmentPageUrl: image?.link,\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t\t} }\n\t\t\t/>\n\t\t</PanelBody>\n\t);\n}\n\nconst UPLOAD_STATE_IDLE = 0;\nconst UPLOAD_STATE_UPLOADING = 1;\nconst UPLOAD_STATE_SUCCEEDED = 2;\nconst UPLOAD_STATE_FAILED = 3;\n\nexport class ImageEdit extends Component {\n\tconstructor( props ) {\n\t\tsuper( props );\n\n\t\tthis.state = {\n\t\t\tisCaptionSelected: false,\n\t\t\tuploadStatus: UPLOAD_STATE_IDLE,\n\t\t};\n\n\t\tthis.replacedFeaturedImage = false;\n\n\t\tthis.finishMediaUploadWithSuccess =\n\t\t\tthis.finishMediaUploadWithSuccess.bind( this );\n\t\tthis.finishMediaUploadWithFailure =\n\t\t\tthis.finishMediaUploadWithFailure.bind( this );\n\t\tthis.mediaUploadStateReset = this.mediaUploadStateReset.bind( this );\n\t\tthis.onSelectMediaUploadOption =\n\t\t\tthis.onSelectMediaUploadOption.bind( this );\n\t\tthis.updateMediaProgress = this.updateMediaProgress.bind( this );\n\t\tthis.updateImageURL = this.updateImageURL.bind( this );\n\t\tthis.onSetNewTab = this.onSetNewTab.bind( this );\n\t\tthis.onSetSizeSlug = this.onSetSizeSlug.bind( this );\n\t\tthis.onImagePressed = this.onImagePressed.bind( this );\n\t\tthis.onSetFeatured = this.onSetFeatured.bind( this );\n\t\tthis.onFocusCaption = this.onFocusCaption.bind( this );\n\t\tthis.onSelectURL = this.onSelectURL.bind( this );\n\t\tthis.updateAlignment = this.updateAlignment.bind( this );\n\t\tthis.accessibilityLabelCreator =\n\t\t\tthis.accessibilityLabelCreator.bind( this );\n\t\tthis.setMappedAttributes = this.setMappedAttributes.bind( this );\n\t\tthis.onSizeChangeValue = this.onSizeChangeValue.bind( this );\n\t}\n\n\tcomponentDidMount() {\n\t\tconst { attributes, setAttributes } = this.props;\n\t\t// This will warn when we have `id` defined, while `url` is undefined.\n\t\t// This may help track this issue: https://github.com/wordpress-mobile/WordPress-Android/issues/9768\n\t\t// where a cancelled image upload was resulting in a subsequent crash.\n\t\tif ( attributes.id && ! attributes.url ) {\n\t\t\t// eslint-disable-next-line no-console\n\t\t\tconsole.warn( 'Attributes has id with no url.' );\n\t\t}\n\n\t\t// Detect any pasted image and start an upload.\n\t\tif (\n\t\t\t! attributes.id &&\n\t\t\tattributes.url &&\n\t\t\tgetProtocol( attributes.url ) === 'file:'\n\t\t) {\n\t\t\trequestMediaImport( attributes.url, ( id, url ) => {\n\t\t\t\tif ( url ) {\n\t\t\t\t\tsetAttributes( { id, url } );\n\t\t\t\t}\n\t\t\t} );\n\t\t}\n\n\t\t// Make sure we mark any temporary images as failed if they failed while\n\t\t// the editor wasn't open.\n\t\tif (\n\t\t\tattributes.id &&\n\t\t\tattributes.url &&\n\t\t\tgetProtocol( attributes.url ) === 'file:'\n\t\t) {\n\t\t\tmediaUploadSync();\n\t\t}\n\t}\n\n\tcomponentWillUnmount() {\n\t\t// This action will only exist if the user pressed the trash button on the block holder.\n\t\tif (\n\t\t\thasAction( 'blocks.onRemoveBlockCheckUpload' ) &&\n\t\t\tthis.state.uploadStatus === UPLOAD_STATE_UPLOADING\n\t\t) {\n\t\t\tdoAction(\n\t\t\t\t'blocks.onRemoveBlockCheckUpload',\n\t\t\t\tthis.props.attributes.id\n\t\t\t);\n\t\t}\n\t}\n\n\tcomponentDidUpdate( previousProps ) {\n\t\tconst { image, attributes, setAttributes, featuredImageId } =\n\t\t\tthis.props;\n\t\tconst { url } = attributes;\n\t\tif ( ! previousProps.image && image ) {\n\t\t\tif ( ! hasQueryArg( url, 'w' ) && attributes?.sizeSlug ) {\n\t\t\t\tconst updatedUrl =\n\t\t\t\t\tgetUrlForSlug( image, attributes.sizeSlug ) ||\n\t\t\t\t\timage.source_url;\n\n\t\t\t\tsetAttributes( { url: updatedUrl } );\n\t\t\t}\n\t\t}\n\n\t\tconst { id } = attributes;\n\t\tconst { id: previousId } = previousProps.attributes;\n\n\t\t// The media changed and the previous media was set as the Featured Image,\n\t\t// we must keep track of the previous media's featured status to act on it\n\t\t// once the new media has a finalized ID.\n\t\tif (\n\t\t\t!! id &&\n\t\t\tid !== previousId &&\n\t\t\t!! featuredImageId &&\n\t\t\tfeaturedImageId === previousId\n\t\t) {\n\t\t\tthis.replacedFeaturedImage = true;\n\t\t}\n\n\t\t// The media changed and now has a finalized ID (e.g. upload completed), we\n\t\t// should attempt to replace the featured image if applicable.\n\t\tif (\n\t\t\tthis.replacedFeaturedImage &&\n\t\t\t!! image &&\n\t\t\tthis.canImageBeFeatured()\n\t\t) {\n\t\t\tthis.replacedFeaturedImage = false;\n\t\t\tsetFeaturedImage( id );\n\t\t}\n\t}\n\n\tstatic getDerivedStateFromProps( props, state ) {\n\t\t// Avoid a UI flicker in the toolbar by insuring that isCaptionSelected\n\t\t// is updated immediately any time the isSelected prop becomes false.\n\t\treturn {\n\t\t\tisCaptionSelected: props.isSelected && state.isCaptionSelected,\n\t\t};\n\t}\n\n\taccessibilityLabelCreator( caption ) {\n\t\t// Checks if caption is empty.\n\t\treturn ( typeof caption === 'string' && caption.trim().length === 0 ) ||\n\t\t\tcaption === undefined ||\n\t\t\tcaption === null\n\t\t\t? /* translators: accessibility text. Empty image caption. */\n\t\t\t  'Image caption. Empty'\n\t\t\t: sprintf(\n\t\t\t\t\t/* translators: accessibility text. %s: image caption. */\n\t\t\t\t\t__( 'Image caption. %s' ),\n\t\t\t\t\tcaption\n\t\t\t  );\n\t}\n\n\tonImagePressed() {\n\t\tconst { attributes, image } = this.props;\n\n\t\tif ( this.state.uploadStatus === UPLOAD_STATE_UPLOADING ) {\n\t\t\trequestImageUploadCancelDialog( attributes.id );\n\t\t} else if (\n\t\t\tattributes.id &&\n\t\t\tgetProtocol( attributes.url ) === 'file:'\n\t\t) {\n\t\t\trequestImageFailedRetryDialog( attributes.id );\n\t\t} else if ( ! this.state.isCaptionSelected ) {\n\t\t\trequestImageFullscreenPreview(\n\t\t\t\tattributes.url,\n\t\t\t\timage && image.source_url\n\t\t\t);\n\t\t}\n\n\t\tthis.setState( {\n\t\t\tisCaptionSelected: false,\n\t\t} );\n\t}\n\n\tupdateMediaProgress( payload ) {\n\t\tconst { setAttributes } = this.props;\n\t\tif ( payload.mediaUrl ) {\n\t\t\tsetAttributes( { url: payload.mediaUrl } );\n\t\t}\n\n\t\tif ( this.state.uploadStatus !== UPLOAD_STATE_UPLOADING ) {\n\t\t\tthis.setState( { uploadStatus: UPLOAD_STATE_UPLOADING } );\n\t\t}\n\t}\n\n\tfinishMediaUploadWithSuccess( payload ) {\n\t\tconst { setAttributes } = this.props;\n\n\t\tsetAttributes( { url: payload.mediaUrl, id: payload.mediaServerId } );\n\t\tthis.setState( { uploadStatus: UPLOAD_STATE_SUCCEEDED } );\n\t}\n\n\tfinishMediaUploadWithFailure( payload ) {\n\t\tconst { setAttributes } = this.props;\n\n\t\tsetAttributes( { id: payload.mediaId } );\n\t\tthis.setState( { uploadStatus: UPLOAD_STATE_FAILED } );\n\t}\n\n\tmediaUploadStateReset() {\n\t\tconst { setAttributes } = this.props;\n\n\t\tsetAttributes( { id: null, url: null } );\n\t\tthis.setState( { uploadStatus: UPLOAD_STATE_IDLE } );\n\t}\n\n\tupdateImageURL( url ) {\n\t\tthis.props.setAttributes( {\n\t\t\turl,\n\t\t\twidth: undefined,\n\t\t\theight: undefined,\n\t\t} );\n\t}\n\n\tupdateAlignment( nextAlign ) {\n\t\tconst extraUpdatedAttributes = Object.values(\n\t\t\tWIDE_ALIGNMENTS.alignments\n\t\t).includes( nextAlign )\n\t\t\t? { width: undefined, height: undefined }\n\t\t\t: {};\n\t\tthis.props.setAttributes( {\n\t\t\t...extraUpdatedAttributes,\n\t\t\talign: nextAlign,\n\t\t} );\n\t}\n\n\tonSetNewTab( value ) {\n\t\tconst updatedLinkTarget = getUpdatedLinkTargetSettings(\n\t\t\tvalue,\n\t\t\tthis.props.attributes\n\t\t);\n\t\tthis.props.setAttributes( updatedLinkTarget );\n\t}\n\n\tonSetSizeSlug( sizeSlug ) {\n\t\tconst { image, setAttributes } = this.props;\n\n\t\tconst url = getUrlForSlug( image, sizeSlug );\n\t\tif ( ! url ) {\n\t\t\treturn null;\n\t\t}\n\t\tsetAttributes( {\n\t\t\turl,\n\t\t\twidth: undefined,\n\t\t\theight: undefined,\n\t\t\tsizeSlug,\n\t\t} );\n\t}\n\n\tonSelectMediaUploadOption( media ) {\n\t\tconst { imageDefaultSize } = this.props;\n\t\tconst { id, url, destination } = this.props.attributes;\n\t\tconst mediaAttributes = {\n\t\t\tid: media.id,\n\t\t\turl: media.url,\n\t\t\tcaption: media.caption,\n\t\t\talt: media.alt,\n\t\t};\n\n\t\tlet additionalAttributes;\n\t\t// Reset the dimension attributes if changing to a different image.\n\t\tif ( ! media.id || media.id !== id ) {\n\t\t\tadditionalAttributes = {\n\t\t\t\twidth: undefined,\n\t\t\t\theight: undefined,\n\t\t\t\tsizeSlug: imageDefaultSize,\n\t\t\t};\n\t\t} else {\n\t\t\t// Keep the same url when selecting the same file, so \"Image Size\" option is not changed.\n\t\t\tadditionalAttributes = { url };\n\t\t}\n\n\t\tlet href;\n\t\tswitch ( destination ) {\n\t\t\tcase LINK_DESTINATION_MEDIA:\n\t\t\t\thref = media.url;\n\t\t\t\tbreak;\n\t\t\tcase LINK_DESTINATION_ATTACHMENT:\n\t\t\t\thref = media.link;\n\t\t\t\tbreak;\n\t\t}\n\t\tmediaAttributes.href = href;\n\n\t\tthis.props.setAttributes( {\n\t\t\t...mediaAttributes,\n\t\t\t...additionalAttributes,\n\t\t} );\n\t}\n\n\tonSelectURL( newURL ) {\n\t\tconst { createErrorNotice, imageDefaultSize, setAttributes } =\n\t\t\tthis.props;\n\n\t\tif ( isURL( newURL ) ) {\n\t\t\tthis.setState( {\n\t\t\t\tisFetchingImage: true,\n\t\t\t} );\n\n\t\t\t// Use RN's Image.getSize to determine if URL is a valid image\n\t\t\tRNImage.getSize(\n\t\t\t\tnewURL,\n\t\t\t\t() => {\n\t\t\t\t\tsetAttributes( {\n\t\t\t\t\t\turl: newURL,\n\t\t\t\t\t\tid: undefined,\n\t\t\t\t\t\twidth: undefined,\n\t\t\t\t\t\theight: undefined,\n\t\t\t\t\t\tsizeSlug: imageDefaultSize,\n\t\t\t\t\t} );\n\t\t\t\t\tthis.setState( {\n\t\t\t\t\t\tisFetchingImage: false,\n\t\t\t\t\t} );\n\t\t\t\t},\n\t\t\t\t() => {\n\t\t\t\t\tcreateErrorNotice( __( 'Image file not found.' ) );\n\t\t\t\t\tthis.setState( {\n\t\t\t\t\t\tisFetchingImage: false,\n\t\t\t\t\t} );\n\t\t\t\t}\n\t\t\t);\n\t\t} else {\n\t\t\tcreateErrorNotice( __( 'Invalid URL.' ) );\n\t\t}\n\t}\n\n\tonFocusCaption() {\n\t\tif ( this.props.onFocus ) {\n\t\t\tthis.props.onFocus();\n\t\t}\n\t\tif ( ! this.state.isCaptionSelected ) {\n\t\t\tthis.setState( {\n\t\t\t\tisCaptionSelected: true,\n\t\t\t} );\n\t\t}\n\t}\n\n\tgetPlaceholderIcon() {\n\t\treturn (\n\t\t\t<Icon\n\t\t\t\ticon={ placeholderIcon }\n\t\t\t\t{ ...this.props.getStylesFromColorScheme(\n\t\t\t\t\tstyles.iconPlaceholder,\n\t\t\t\t\tstyles.iconPlaceholderDark\n\t\t\t\t) }\n\t\t\t/>\n\t\t);\n\t}\n\n\tshowLoadingIndicator() {\n\t\treturn (\n\t\t\t<View style={ styles.image__loading }>\n\t\t\t\t<ActivityIndicator animating />\n\t\t\t</View>\n\t\t);\n\t}\n\n\tgetWidth() {\n\t\tconst { attributes } = this.props;\n\t\tconst { align, width } = attributes;\n\n\t\treturn Object.values( WIDE_ALIGNMENTS.alignments ).includes( align )\n\t\t\t? '100%'\n\t\t\t: width;\n\t}\n\n\tsetMappedAttributes( { url: href, linkDestination, ...restAttributes } ) {\n\t\tconst { setAttributes } = this.props;\n\t\tif ( ! href && ! linkDestination ) {\n\t\t\tlinkDestination = LINK_DESTINATION_NONE;\n\t\t} else if ( ! linkDestination ) {\n\t\t\tlinkDestination = LINK_DESTINATION_CUSTOM;\n\t\t}\n\n\t\treturn href === undefined || href === this.props.attributes.href\n\t\t\t? setAttributes( restAttributes )\n\t\t\t: setAttributes( {\n\t\t\t\t\t...restAttributes,\n\t\t\t\t\tlinkDestination,\n\t\t\t\t\thref,\n\t\t\t  } );\n\t}\n\n\tgetAltTextSettings() {\n\t\tconst {\n\t\t\tattributes: { alt },\n\t\t} = this.props;\n\n\t\tconst updateAlt = ( newAlt ) => {\n\t\t\tthis.props.setAttributes( { alt: newAlt } );\n\t\t};\n\n\t\treturn (\n\t\t\t<BottomSheetTextControl\n\t\t\t\tinitialValue={ alt }\n\t\t\t\tonChange={ updateAlt }\n\t\t\t\tplaceholder={ __( 'Add alt text' ) }\n\t\t\t\tlabel={ __( 'Alt Text' ) }\n\t\t\t\ticon={ textColor }\n\t\t\t\tfooterNote={\n\t\t\t\t\t<>\n\t\t\t\t\t\t{ __(\n\t\t\t\t\t\t\t'Describe the purpose of the image. Leave empty if decorative.'\n\t\t\t\t\t\t) }{ ' ' }\n\t\t\t\t\t\t<FooterMessageLink\n\t\t\t\t\t\t\thref={\n\t\t\t\t\t\t\t\t'https://www.w3.org/WAI/tutorials/images/decision-tree/'\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tvalue={ __( 'What is alt text?' ) }\n\t\t\t\t\t\t/>\n\t\t\t\t\t</>\n\t\t\t\t}\n\t\t\t/>\n\t\t);\n\t}\n\n\tonSizeChangeValue( newValue ) {\n\t\tthis.onSetSizeSlug( newValue );\n\t}\n\n\tonSetFeatured( mediaId ) {\n\t\tconst { closeSettingsBottomSheet } = this.props;\n\t\tsetFeaturedImage( mediaId );\n\t\tcloseSettingsBottomSheet();\n\t}\n\n\tgetFeaturedButtonPanel( isFeaturedImage ) {\n\t\tconst { attributes, getStylesFromColorScheme } = this.props;\n\n\t\tconst setFeaturedButtonStyle = getStylesFromColorScheme(\n\t\t\tstyles.setFeaturedButton,\n\t\t\tstyles.setFeaturedButtonDark\n\t\t);\n\n\t\tconst removeFeaturedButton = () => (\n\t\t\t<BottomSheet.Cell\n\t\t\t\tlabel={ __( 'Remove as Featured Image' ) }\n\t\t\t\tlabelStyle={ [\n\t\t\t\t\tsetFeaturedButtonStyle,\n\t\t\t\t\tstyles.removeFeaturedButton,\n\t\t\t\t] }\n\t\t\t\tcellContainerStyle={ styles.setFeaturedButtonCellContainer }\n\t\t\t\tseparatorType={ 'none' }\n\t\t\t\tonPress={ () =>\n\t\t\t\t\tthis.onSetFeatured( MEDIA_ID_NO_FEATURED_IMAGE_SET )\n\t\t\t\t}\n\t\t\t/>\n\t\t);\n\n\t\tconst setFeaturedButton = () => (\n\t\t\t<BottomSheet.Cell\n\t\t\t\tlabel={ __( 'Set as Featured Image' ) }\n\t\t\t\tlabelStyle={ setFeaturedButtonStyle }\n\t\t\t\tcellContainerStyle={ styles.setFeaturedButtonCellContainer }\n\t\t\t\tseparatorType={ 'none' }\n\t\t\t\tonPress={ () => this.onSetFeatured( attributes.id ) }\n\t\t\t/>\n\t\t);\n\n\t\treturn isFeaturedImage ? removeFeaturedButton() : setFeaturedButton();\n\t}\n\n\t/**\n\t * Featured images must be set to a successfully uploaded self-hosted image,\n\t * which has an ID.\n\t *\n\t * @return {boolean} Boolean indicating whether or not the current may be set as featured.\n\t */\n\tcanImageBeFeatured() {\n\t\tconst {\n\t\t\tattributes: { id },\n\t\t} = this.props;\n\t\treturn (\n\t\t\ttypeof id !== 'undefined' &&\n\t\t\tthis.state.uploadStatus !== UPLOAD_STATE_UPLOADING &&\n\t\t\tthis.state.uploadStatus !== UPLOAD_STATE_FAILED\n\t\t);\n\t}\n\n\tisGif( url ) {\n\t\treturn url.toLowerCase().includes( '.gif' );\n\t}\n\n\trender() {\n\t\tconst { isCaptionSelected, isFetchingImage } = this.state;\n\t\tconst {\n\t\t\tattributes,\n\t\t\tisSelected,\n\t\t\timage,\n\t\t\tclientId,\n\t\t\timageDefaultSize,\n\t\t\tcontext,\n\t\t\tfeaturedImageId,\n\t\t\twasBlockJustInserted,\n\t\t\tshouldUseFastImage,\n\t\t} = this.props;\n\t\tconst { align, url, alt, id, sizeSlug, className } = attributes;\n\t\tconst hasImageContext = context\n\t\t\t? Object.keys( context ).length > 0\n\t\t\t: false;\n\n\t\tconst imageSizes = Array.isArray( this.props.imageSizes )\n\t\t\t? this.props.imageSizes\n\t\t\t: [];\n\t\t// Only map available image sizes for the user to choose.\n\t\tconst sizeOptions = imageSizes\n\t\t\t.filter( ( { slug } ) => getUrlForSlug( image, slug ) )\n\t\t\t.map( ( { name, slug } ) => ( { value: slug, label: name } ) );\n\n\t\tlet selectedSizeOption = sizeSlug || imageDefaultSize;\n\t\tlet sizeOptionsValid = sizeOptions.find(\n\t\t\t( option ) => option.value === selectedSizeOption\n\t\t);\n\n\t\tif ( ! sizeOptionsValid ) {\n\t\t\t// Default to 'full' size if the default large size is not available.\n\t\t\tsizeOptionsValid = sizeOptions.find(\n\t\t\t\t( option ) => option.value === 'full'\n\t\t\t);\n\t\t\tselectedSizeOption = 'full';\n\t\t}\n\n\t\tconst canImageBeFeatured = this.canImageBeFeatured();\n\t\tconst isFeaturedImage =\n\t\t\tcanImageBeFeatured && featuredImageId === attributes.id;\n\n\t\tconst getToolbarEditButton = ( open ) => (\n\t\t\t<BlockControls>\n\t\t\t\t<ToolbarGroup>\n\t\t\t\t\t<ToolbarButton\n\t\t\t\t\t\ttitle={ __( 'Edit image' ) }\n\t\t\t\t\t\ticon={ replace }\n\t\t\t\t\t\tonClick={ open }\n\t\t\t\t\t/>\n\t\t\t\t</ToolbarGroup>\n\t\t\t\t<BlockAlignmentToolbar\n\t\t\t\t\tvalue={ align }\n\t\t\t\t\tonChange={ this.updateAlignment }\n\t\t\t\t/>\n\t\t\t</BlockControls>\n\t\t);\n\n\t\tconst getInspectorControls = () => (\n\t\t\t<InspectorControls>\n\t\t\t\t<PanelBody title={ __( 'Settings' ) } />\n\t\t\t\t<PanelBody style={ styles.panelBody }>\n\t\t\t\t\t<BlockStyles clientId={ clientId } url={ url } />\n\t\t\t\t</PanelBody>\n\t\t\t\t<PanelBody>\n\t\t\t\t\t{ image && sizeOptionsValid && (\n\t\t\t\t\t\t<BottomSheetSelectControl\n\t\t\t\t\t\t\ticon={ fullscreen }\n\t\t\t\t\t\t\tlabel={ __( 'Size' ) }\n\t\t\t\t\t\t\toptions={ sizeOptions }\n\t\t\t\t\t\t\tonChange={ this.onSizeChangeValue }\n\t\t\t\t\t\t\tvalue={ selectedSizeOption }\n\t\t\t\t\t\t/>\n\t\t\t\t\t) }\n\t\t\t\t\t{ this.getAltTextSettings() }\n\t\t\t\t</PanelBody>\n\t\t\t\t<LinkSettings\n\t\t\t\t\tattributes={ this.props.attributes }\n\t\t\t\t\timage={ this.props.image }\n\t\t\t\t\tisLinkSheetVisible={ this.state.isLinkSheetVisible }\n\t\t\t\t\tsetMappedAttributes={ this.setMappedAttributes }\n\t\t\t\t/>\n\t\t\t\t<PanelBody\n\t\t\t\t\ttitle={ __( 'Featured Image' ) }\n\t\t\t\t\ttitleStyle={ styles.featuredImagePanelTitle }\n\t\t\t\t>\n\t\t\t\t\t{ canImageBeFeatured &&\n\t\t\t\t\t\tthis.getFeaturedButtonPanel( isFeaturedImage ) }\n\t\t\t\t\t<FooterMessageControl\n\t\t\t\t\t\tlabel={ __(\n\t\t\t\t\t\t\t'Changes to featured image will not be affected by the undo/redo buttons.'\n\t\t\t\t\t\t) }\n\t\t\t\t\t\tcellContainerStyle={\n\t\t\t\t\t\t\tstyles.setFeaturedButtonCellContainer\n\t\t\t\t\t\t}\n\t\t\t\t\t/>\n\t\t\t\t</PanelBody>\n\t\t\t</InspectorControls>\n\t\t);\n\n\t\tif ( ! url ) {\n\t\t\treturn (\n\t\t\t\t<View style={ styles.content }>\n\t\t\t\t\t{ isFetchingImage && this.showLoadingIndicator() }\n\t\t\t\t\t<MediaPlaceholder\n\t\t\t\t\t\tallowedTypes={ [ MEDIA_TYPE_IMAGE ] }\n\t\t\t\t\t\tonSelect={ this.onSelectMediaUploadOption }\n\t\t\t\t\t\tonSelectURL={ this.onSelectURL }\n\t\t\t\t\t\ticon={ this.getPlaceholderIcon() }\n\t\t\t\t\t\tonFocus={ this.props.onFocus }\n\t\t\t\t\t\tautoOpenMediaUpload={\n\t\t\t\t\t\t\tisSelected && wasBlockJustInserted\n\t\t\t\t\t\t}\n\t\t\t\t\t/>\n\t\t\t\t</View>\n\t\t\t);\n\t\t}\n\n\t\tconst alignToFlex = {\n\t\t\tleft: 'flex-start',\n\t\t\tcenter: 'center',\n\t\t\tright: 'flex-end',\n\t\t\tfull: 'center',\n\t\t\twide: 'center',\n\t\t};\n\n\t\tconst additionalImageProps = {\n\t\t\theight: '100%',\n\t\t\tresizeMode: context?.imageCrop ? 'cover' : 'contain',\n\t\t};\n\n\t\tconst imageContainerStyles = [\n\t\t\tcontext?.fixedHeight && styles.fixedHeight,\n\t\t];\n\n\t\tconst isGif = this.isGif( url );\n\t\tconst badgeLabelShown = isFeaturedImage || isGif;\n\t\tlet badgeLabelText = '';\n\t\tif ( isFeaturedImage ) {\n\t\t\tbadgeLabelText = __( 'Featured' );\n\t\t} else if ( isGif ) {\n\t\t\tbadgeLabelText = __( 'GIF' );\n\t\t}\n\n\t\tconst getImageComponent = ( openMediaOptions, getMediaOptions ) => (\n\t\t\t<Badge label={ badgeLabelText } show={ badgeLabelShown }>\n\t\t\t\t<TouchableWithoutFeedback\n\t\t\t\t\taccessible={ ! isSelected }\n\t\t\t\t\tonPress={ this.onImagePressed }\n\t\t\t\t\tdisabled={ ! isSelected }\n\t\t\t\t>\n\t\t\t\t\t<View style={ styles.content }>\n\t\t\t\t\t\t{ isSelected && getInspectorControls() }\n\t\t\t\t\t\t{ isSelected && getMediaOptions() }\n\t\t\t\t\t\t{ ! this.state.isCaptionSelected &&\n\t\t\t\t\t\t\tgetToolbarEditButton( openMediaOptions ) }\n\t\t\t\t\t\t<MediaUploadProgress\n\t\t\t\t\t\t\tcoverUrl={ url }\n\t\t\t\t\t\t\tmediaId={ id }\n\t\t\t\t\t\t\tonUpdateMediaProgress={ this.updateMediaProgress }\n\t\t\t\t\t\t\tonFinishMediaUploadWithSuccess={\n\t\t\t\t\t\t\t\tthis.finishMediaUploadWithSuccess\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tonFinishMediaUploadWithFailure={\n\t\t\t\t\t\t\t\tthis.finishMediaUploadWithFailure\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tonMediaUploadStateReset={\n\t\t\t\t\t\t\t\tthis.mediaUploadStateReset\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\trenderContent={ ( {\n\t\t\t\t\t\t\t\tisUploadInProgress,\n\t\t\t\t\t\t\t\tisUploadFailed,\n\t\t\t\t\t\t\t\tretryMessage,\n\t\t\t\t\t\t\t} ) => {\n\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t<View style={ imageContainerStyles }>\n\t\t\t\t\t\t\t\t\t\t{ isFetchingImage &&\n\t\t\t\t\t\t\t\t\t\t\tthis.showLoadingIndicator() }\n\t\t\t\t\t\t\t\t\t\t<Image\n\t\t\t\t\t\t\t\t\t\t\talign={\n\t\t\t\t\t\t\t\t\t\t\t\talign && alignToFlex[ align ]\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\talt={ alt }\n\t\t\t\t\t\t\t\t\t\t\tisSelected={\n\t\t\t\t\t\t\t\t\t\t\t\tisSelected &&\n\t\t\t\t\t\t\t\t\t\t\t\t! isCaptionSelected\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\tisUploadFailed={ isUploadFailed }\n\t\t\t\t\t\t\t\t\t\t\tisUploadInProgress={\n\t\t\t\t\t\t\t\t\t\t\t\tisUploadInProgress\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\tshouldUseFastImage={\n\t\t\t\t\t\t\t\t\t\t\t\tshouldUseFastImage\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\tonSelectMediaUploadOption={\n\t\t\t\t\t\t\t\t\t\t\t\tthis.onSelectMediaUploadOption\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\topenMediaOptions={\n\t\t\t\t\t\t\t\t\t\t\t\topenMediaOptions\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\tretryMessage={ retryMessage }\n\t\t\t\t\t\t\t\t\t\t\turl={ url }\n\t\t\t\t\t\t\t\t\t\t\tshapeStyle={\n\t\t\t\t\t\t\t\t\t\t\t\tstyles[ className ] || className\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\twidth={ this.getWidth() }\n\t\t\t\t\t\t\t\t\t\t\t{ ...( hasImageContext\n\t\t\t\t\t\t\t\t\t\t\t\t? additionalImageProps\n\t\t\t\t\t\t\t\t\t\t\t\t: {} ) }\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t</View>\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t/>\n\t\t\t\t\t</View>\n\t\t\t\t</TouchableWithoutFeedback>\n\t\t\t\t<BlockCaption\n\t\t\t\t\tclientId={ this.props.clientId }\n\t\t\t\t\tisSelected={ this.state.isCaptionSelected }\n\t\t\t\t\taccessible={ ! this.state.isCaptionSelected }\n\t\t\t\t\taccessibilityLabelCreator={ this.accessibilityLabelCreator }\n\t\t\t\t\tonFocus={ this.onFocusCaption }\n\t\t\t\t\tonBlur={ this.props.onBlur } // Always assign onBlur as props.\n\t\t\t\t\tinsertBlocksAfter={ this.props.insertBlocksAfter }\n\t\t\t\t/>\n\t\t\t</Badge>\n\t\t);\n\n\t\treturn (\n\t\t\t<MediaUpload\n\t\t\t\tallowedTypes={ [ MEDIA_TYPE_IMAGE ] }\n\t\t\t\tisReplacingMedia={ true }\n\t\t\t\tonSelect={ this.onSelectMediaUploadOption }\n\t\t\t\tonSelectURL={ this.onSelectURL }\n\t\t\t\trender={ ( { open, getMediaOptions } ) => {\n\t\t\t\t\treturn getImageComponent( open, getMediaOptions );\n\t\t\t\t} }\n\t\t\t/>\n\t\t);\n\t}\n}\n\nexport default compose( [\n\twithSelect( ( select, props ) => {\n\t\tconst { getMedia } = select( coreStore );\n\t\tconst { getSettings, wasBlockJustInserted } =\n\t\t\tselect( blockEditorStore );\n\t\tconst { getEditedPostAttribute } = select( 'core/editor' );\n\t\tconst {\n\t\t\tattributes: { id, url },\n\t\t\tisSelected,\n\t\t\tclientId,\n\t\t} = props;\n\t\tconst { imageSizes, imageDefaultSize, capabilities } = getSettings();\n\t\tconst isNotFileUrl = id && getProtocol( url ) !== 'file:';\n\t\tconst featuredImageId = getEditedPostAttribute( 'featured_media' );\n\n\t\tconst shouldGetMedia =\n\t\t\t( isSelected && isNotFileUrl ) ||\n\t\t\t// Edge case to update the image after uploading if the block gets unselected\n\t\t\t// Check if it's the original image and not the resized one with queryparams.\n\t\t\t( ! isSelected &&\n\t\t\t\tisNotFileUrl &&\n\t\t\t\turl &&\n\t\t\t\t! hasQueryArg( url, 'w' ) );\n\t\tconst image = shouldGetMedia ? getMedia( id ) : null;\n\n\t\treturn {\n\t\t\timage,\n\t\t\timageSizes,\n\t\t\timageDefaultSize,\n\t\t\tshouldUseFastImage: capabilities?.shouldUseFastImage === true,\n\t\t\tfeaturedImageId,\n\t\t\twasBlockJustInserted: wasBlockJustInserted(\n\t\t\t\tclientId,\n\t\t\t\t'inserter_menu'\n\t\t\t),\n\t\t};\n\t} ),\n\twithDispatch( ( dispatch ) => {\n\t\tconst { createErrorNotice } = dispatch( noticesStore );\n\n\t\treturn {\n\t\t\tcreateErrorNotice,\n\t\t\tcloseSettingsBottomSheet() {\n\t\t\t\tdispatch( editPostStore ).closeGeneralSidebar();\n\t\t\t},\n\t\t};\n\t} ),\n\twithPreferredColorScheme,\n] )( ImageEdit );\n"],"mappings":"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"}