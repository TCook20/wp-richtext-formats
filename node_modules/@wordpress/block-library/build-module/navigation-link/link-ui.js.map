{"version":3,"names":["__unstableStripHTML","stripHTML","Popover","Button","__","sprintf","__experimentalLinkControl","LinkControl","BlockIcon","store","blockEditorStore","createInterpolateElement","useMemo","coreStore","useResourcePermissions","decodeEntities","switchToBlockType","useSelect","useDispatch","getSuggestionsQuery","type","kind","subtype","LinkControlTransforms","clientId","getBlock","blockTransforms","select","_getBlock","getBlockRootClientId","getBlockTransformItems","replaceBlock","featuredBlocks","transforms","filter","item","includes","name","length","createElement","className","map","index","key","onClick","icon","title","LinkUI","props","saveEntityRecord","pagesPermissions","postsPermissions","handleCreate","pageTitle","postType","link","page","status","id","rendered","url","label","opensInNewTab","userCanCreate","canCreate","placement","onClose","anchor","shift","hasTextControl","hasRichPreviews","value","showInitialSuggestions","withCreateSuggestion","createSuggestion","createSuggestionButtonText","searchTerm","format","mark","noDirectEntry","noURLSuggestion","suggestionsQuery","onChange","onRemove","onCancel","renderControlBottom"],"sources":["@wordpress/block-library/src/navigation-link/link-ui.js"],"sourcesContent":["/**\n * WordPress dependencies\n */\nimport { __unstableStripHTML as stripHTML } from '@wordpress/dom';\nimport { Popover, Button } from '@wordpress/components';\nimport { __, sprintf } from '@wordpress/i18n';\nimport {\n\t__experimentalLinkControl as LinkControl,\n\tBlockIcon,\n\tstore as blockEditorStore,\n} from '@wordpress/block-editor';\nimport { createInterpolateElement, useMemo } from '@wordpress/element';\nimport {\n\tstore as coreStore,\n\tuseResourcePermissions,\n} from '@wordpress/core-data';\nimport { decodeEntities } from '@wordpress/html-entities';\nimport { switchToBlockType } from '@wordpress/blocks';\nimport { useSelect, useDispatch } from '@wordpress/data';\n\n/**\n * Given the Link block's type attribute, return the query params to give to\n * /wp/v2/search.\n *\n * @param {string} type Link block's type attribute.\n * @param {string} kind Link block's entity of kind (post-type|taxonomy)\n * @return {{ type?: string, subtype?: string }} Search query params.\n */\nexport function getSuggestionsQuery( type, kind ) {\n\tswitch ( type ) {\n\t\tcase 'post':\n\t\tcase 'page':\n\t\t\treturn { type: 'post', subtype: type };\n\t\tcase 'category':\n\t\t\treturn { type: 'term', subtype: 'category' };\n\t\tcase 'tag':\n\t\t\treturn { type: 'term', subtype: 'post_tag' };\n\t\tcase 'post_format':\n\t\t\treturn { type: 'post-format' };\n\t\tdefault:\n\t\t\tif ( kind === 'taxonomy' ) {\n\t\t\t\treturn { type: 'term', subtype: type };\n\t\t\t}\n\t\t\tif ( kind === 'post-type' ) {\n\t\t\t\treturn { type: 'post', subtype: type };\n\t\t\t}\n\t\t\treturn {};\n\t}\n}\n\n/**\n * Add transforms to Link Control\n *\n * @param {Object} props          Component props.\n * @param {string} props.clientId Block client ID.\n */\nfunction LinkControlTransforms( { clientId } ) {\n\tconst { getBlock, blockTransforms } = useSelect(\n\t\t( select ) => {\n\t\t\tconst {\n\t\t\t\tgetBlock: _getBlock,\n\t\t\t\tgetBlockRootClientId,\n\t\t\t\tgetBlockTransformItems,\n\t\t\t} = select( blockEditorStore );\n\n\t\t\treturn {\n\t\t\t\tgetBlock: _getBlock,\n\t\t\t\tblockTransforms: getBlockTransformItems(\n\t\t\t\t\t_getBlock( clientId ),\n\t\t\t\t\tgetBlockRootClientId( clientId )\n\t\t\t\t),\n\t\t\t};\n\t\t},\n\t\t[ clientId ]\n\t);\n\n\tconst { replaceBlock } = useDispatch( blockEditorStore );\n\n\tconst featuredBlocks = [\n\t\t'core/page-list',\n\t\t'core/site-logo',\n\t\t'core/social-links',\n\t\t'core/search',\n\t];\n\n\tconst transforms = blockTransforms.filter( ( item ) => {\n\t\treturn featuredBlocks.includes( item.name );\n\t} );\n\n\tif ( ! transforms?.length ) {\n\t\treturn null;\n\t}\n\n\tif ( ! clientId ) {\n\t\treturn null;\n\t}\n\n\treturn (\n\t\t<div className=\"link-control-transform\">\n\t\t\t<h3 className=\"link-control-transform__subheading\">\n\t\t\t\t{ __( 'Transform' ) }\n\t\t\t</h3>\n\t\t\t<div className=\"link-control-transform__items\">\n\t\t\t\t{ transforms.map( ( item, index ) => {\n\t\t\t\t\treturn (\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\tkey={ `transform-${ index }` }\n\t\t\t\t\t\t\tonClick={ () =>\n\t\t\t\t\t\t\t\treplaceBlock(\n\t\t\t\t\t\t\t\t\tclientId,\n\t\t\t\t\t\t\t\t\tswitchToBlockType(\n\t\t\t\t\t\t\t\t\t\tgetBlock( clientId ),\n\t\t\t\t\t\t\t\t\t\titem.name\n\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tclassName=\"link-control-transform__item\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<BlockIcon icon={ item.icon } />\n\t\t\t\t\t\t\t{ item.title }\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t);\n\t\t\t\t} ) }\n\t\t\t</div>\n\t\t</div>\n\t);\n}\n\nexport function LinkUI( props ) {\n\tconst { saveEntityRecord } = useDispatch( coreStore );\n\tconst pagesPermissions = useResourcePermissions( 'pages' );\n\tconst postsPermissions = useResourcePermissions( 'posts' );\n\n\tasync function handleCreate( pageTitle ) {\n\t\tconst postType = props.link.type || 'page';\n\n\t\tconst page = await saveEntityRecord( 'postType', postType, {\n\t\t\ttitle: pageTitle,\n\t\t\tstatus: 'draft',\n\t\t} );\n\n\t\treturn {\n\t\t\tid: page.id,\n\t\t\ttype: postType,\n\t\t\t// Make `title` property consistent with that in `fetchLinkSuggestions` where the `rendered` title (containing HTML entities)\n\t\t\t// is also being decoded. By being consistent in both locations we avoid having to branch in the rendering output code.\n\t\t\t// Ideally in the future we will update both APIs to utilise the \"raw\" form of the title which is better suited to edit contexts.\n\t\t\t// e.g.\n\t\t\t// - title.raw = \"Yes & No\"\n\t\t\t// - title.rendered = \"Yes &#038; No\"\n\t\t\t// - decodeEntities( title.rendered ) = \"Yes & No\"\n\t\t\t// See:\n\t\t\t// - https://github.com/WordPress/gutenberg/pull/41063\n\t\t\t// - https://github.com/WordPress/gutenberg/blob/a1e1fdc0e6278457e9f4fc0b31ac6d2095f5450b/packages/core-data/src/fetch/__experimental-fetch-link-suggestions.js#L212-L218\n\t\t\ttitle: decodeEntities( page.title.rendered ),\n\t\t\turl: page.link,\n\t\t\tkind: 'post-type',\n\t\t};\n\t}\n\n\tconst { label, url, opensInNewTab, type, kind } = props.link;\n\n\tlet userCanCreate = false;\n\tif ( ! type || type === 'page' ) {\n\t\tuserCanCreate = pagesPermissions.canCreate;\n\t} else if ( type === 'post' ) {\n\t\tuserCanCreate = postsPermissions.canCreate;\n\t}\n\n\t// Memoize link value to avoid overriding the LinkControl's internal state.\n\t// This is a temporary fix. See https://github.com/WordPress/gutenberg/issues/50976#issuecomment-1568226407.\n\tconst link = useMemo(\n\t\t() => ( {\n\t\t\turl,\n\t\t\topensInNewTab,\n\t\t\ttitle: label && stripHTML( label ),\n\t\t} ),\n\t\t[ label, opensInNewTab, url ]\n\t);\n\n\treturn (\n\t\t<Popover\n\t\t\tplacement=\"bottom\"\n\t\t\tonClose={ props.onClose }\n\t\t\tanchor={ props.anchor }\n\t\t\tshift\n\t\t>\n\t\t\t<LinkControl\n\t\t\t\thasTextControl\n\t\t\t\thasRichPreviews\n\t\t\t\tvalue={ link }\n\t\t\t\tshowInitialSuggestions={ true }\n\t\t\t\twithCreateSuggestion={ userCanCreate }\n\t\t\t\tcreateSuggestion={ handleCreate }\n\t\t\t\tcreateSuggestionButtonText={ ( searchTerm ) => {\n\t\t\t\t\tlet format;\n\n\t\t\t\t\tif ( type === 'post' ) {\n\t\t\t\t\t\t/* translators: %s: search term. */\n\t\t\t\t\t\tformat = __( 'Create draft post: <mark>%s</mark>' );\n\t\t\t\t\t} else {\n\t\t\t\t\t\t/* translators: %s: search term. */\n\t\t\t\t\t\tformat = __( 'Create draft page: <mark>%s</mark>' );\n\t\t\t\t\t}\n\n\t\t\t\t\treturn createInterpolateElement(\n\t\t\t\t\t\tsprintf( format, searchTerm ),\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tmark: <mark />,\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t\t} }\n\t\t\t\tnoDirectEntry={ !! type }\n\t\t\t\tnoURLSuggestion={ !! type }\n\t\t\t\tsuggestionsQuery={ getSuggestionsQuery( type, kind ) }\n\t\t\t\tonChange={ props.onChange }\n\t\t\t\tonRemove={ props.onRemove }\n\t\t\t\tonCancel={ props.onCancel }\n\t\t\t\trenderControlBottom={\n\t\t\t\t\t! url\n\t\t\t\t\t\t? () => (\n\t\t\t\t\t\t\t\t<LinkControlTransforms\n\t\t\t\t\t\t\t\t\tclientId={ props.clientId }\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t  )\n\t\t\t\t\t\t: null\n\t\t\t\t}\n\t\t\t/>\n\t\t</Popover>\n\t);\n}\n"],"mappings":"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"}