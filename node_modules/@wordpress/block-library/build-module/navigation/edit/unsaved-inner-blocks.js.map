{"version":3,"names":["useInnerBlocksProps","Disabled","store","coreStore","useSelect","useContext","useEffect","useRef","useMemo","areBlocksDirty","DEFAULT_BLOCK","ALLOWED_BLOCKS","SELECT_NAVIGATION_MENUS_ARGS","EMPTY_OBJECT","UnsavedInnerBlocks","blocks","createNavigationMenu","hasSelection","originalBlocks","current","innerBlocksAreDirty","shouldDirectInsert","every","name","isDisabled","Context","innerBlocksProps","className","renderAppender","undefined","allowedBlocks","defaultBlock","directInsert","isSaving","hasResolvedAllNavigationMenus","select","hasFinishedResolution","isSavingEntityRecord","Wrapper","createElement"],"sources":["@wordpress/block-library/src/navigation/edit/unsaved-inner-blocks.js"],"sourcesContent":["/**\n * WordPress dependencies\n */\nimport { useInnerBlocksProps } from '@wordpress/block-editor';\nimport { Disabled } from '@wordpress/components';\nimport { store as coreStore } from '@wordpress/core-data';\nimport { useSelect } from '@wordpress/data';\nimport { useContext, useEffect, useRef, useMemo } from '@wordpress/element';\n\n/**\n * Internal dependencies\n */\nimport { areBlocksDirty } from './are-blocks-dirty';\nimport {\n\tDEFAULT_BLOCK,\n\tALLOWED_BLOCKS,\n\tSELECT_NAVIGATION_MENUS_ARGS,\n} from '../constants';\n\nconst EMPTY_OBJECT = {};\n\nexport default function UnsavedInnerBlocks( {\n\tblocks,\n\tcreateNavigationMenu,\n\thasSelection,\n} ) {\n\tconst originalBlocks = useRef();\n\n\tuseEffect( () => {\n\t\t// Initially store the uncontrolled inner blocks for\n\t\t// dirty state comparison.\n\t\tif ( ! originalBlocks?.current ) {\n\t\t\toriginalBlocks.current = blocks;\n\t\t}\n\t}, [ blocks ] );\n\n\t// If the current inner blocks are different from the original inner blocks\n\t// from the post content then the user has made changes to the inner blocks.\n\t// At this point the inner blocks can be considered \"dirty\".\n\t// Note: referential equality is not sufficient for comparison as the inner blocks\n\t// of the page list are controlled and may be updated async due to syncing with\n\t// entity records. As a result we need to perform a deep equality check skipping\n\t// the page list's inner blocks.\n\tconst innerBlocksAreDirty = areBlocksDirty(\n\t\toriginalBlocks?.current,\n\t\tblocks\n\t);\n\n\tconst shouldDirectInsert = useMemo(\n\t\t() =>\n\t\t\tblocks.every(\n\t\t\t\t( { name } ) =>\n\t\t\t\t\tname === 'core/navigation-link' ||\n\t\t\t\t\tname === 'core/navigation-submenu' ||\n\t\t\t\t\tname === 'core/page-list'\n\t\t\t),\n\t\t[ blocks ]\n\t);\n\n\t// The block will be disabled in a block preview, use this as a way of\n\t// avoiding the side-effects of this component for block previews.\n\tconst isDisabled = useContext( Disabled.Context );\n\n\tconst innerBlocksProps = useInnerBlocksProps(\n\t\t{\n\t\t\tclassName: 'wp-block-navigation__container',\n\t\t},\n\t\t{\n\t\t\trenderAppender: hasSelection ? undefined : false,\n\t\t\tallowedBlocks: ALLOWED_BLOCKS,\n\t\t\tdefaultBlock: DEFAULT_BLOCK,\n\t\t\tdirectInsert: shouldDirectInsert,\n\t\t}\n\t);\n\n\tconst { isSaving, hasResolvedAllNavigationMenus } = useSelect(\n\t\t( select ) => {\n\t\t\tif ( isDisabled ) {\n\t\t\t\treturn EMPTY_OBJECT;\n\t\t\t}\n\n\t\t\tconst { hasFinishedResolution, isSavingEntityRecord } =\n\t\t\t\tselect( coreStore );\n\n\t\t\treturn {\n\t\t\t\tisSaving: isSavingEntityRecord( 'postType', 'wp_navigation' ),\n\t\t\t\thasResolvedAllNavigationMenus: hasFinishedResolution(\n\t\t\t\t\t'getEntityRecords',\n\t\t\t\t\tSELECT_NAVIGATION_MENUS_ARGS\n\t\t\t\t),\n\t\t\t};\n\t\t},\n\t\t[ isDisabled ]\n\t);\n\n\t// Automatically save the uncontrolled blocks.\n\tuseEffect( () => {\n\t\t// The block will be disabled when used in a BlockPreview.\n\t\t// In this case avoid automatic creation of a wp_navigation post.\n\t\t// Otherwise the user will be spammed with lots of menus!\n\t\t//\n\t\t// Also ensure other navigation menus have loaded so an\n\t\t// accurate name can be created.\n\t\t//\n\t\t// Don't try saving when another save is already\n\t\t// in progress.\n\t\t//\n\t\t// And finally only create the menu when the block is selected,\n\t\t// which is an indication they want to start editing.\n\t\tif (\n\t\t\tisDisabled ||\n\t\t\tisSaving ||\n\t\t\t! hasResolvedAllNavigationMenus ||\n\t\t\t! hasSelection ||\n\t\t\t! innerBlocksAreDirty\n\t\t) {\n\t\t\treturn;\n\t\t}\n\n\t\tcreateNavigationMenu( null, blocks );\n\t}, [\n\t\tblocks,\n\t\tcreateNavigationMenu,\n\t\tisDisabled,\n\t\tisSaving,\n\t\thasResolvedAllNavigationMenus,\n\t\tinnerBlocksAreDirty,\n\t\thasSelection,\n\t] );\n\n\tconst Wrapper = isSaving ? Disabled : 'div';\n\n\treturn <Wrapper { ...innerBlocksProps } />;\n}\n"],"mappings":";AAAA;AACA;AACA;AACA,SAASA,mBAAmB,QAAQ,yBAAyB;AAC7D,SAASC,QAAQ,QAAQ,uBAAuB;AAChD,SAASC,KAAK,IAAIC,SAAS,QAAQ,sBAAsB;AACzD,SAASC,SAAS,QAAQ,iBAAiB;AAC3C,SAASC,UAAU,EAAEC,SAAS,EAAEC,MAAM,EAAEC,OAAO,QAAQ,oBAAoB;;AAE3E;AACA;AACA;AACA,SAASC,cAAc,QAAQ,oBAAoB;AACnD,SACCC,aAAa,EACbC,cAAc,EACdC,4BAA4B,QACtB,cAAc;AAErB,MAAMC,YAAY,GAAG,CAAC,CAAC;AAEvB,eAAe,SAASC,kBAAkBA,CAAE;EAC3CC,MAAM;EACNC,oBAAoB;EACpBC;AACD,CAAC,EAAG;EACH,MAAMC,cAAc,GAAGX,MAAM,CAAC,CAAC;EAE/BD,SAAS,CAAE,MAAM;IAChB;IACA;IACA,IAAK,CAAEY,cAAc,EAAEC,OAAO,EAAG;MAChCD,cAAc,CAACC,OAAO,GAAGJ,MAAM;IAChC;EACD,CAAC,EAAE,CAAEA,MAAM,CAAG,CAAC;;EAEf;EACA;EACA;EACA;EACA;EACA;EACA;EACA,MAAMK,mBAAmB,GAAGX,cAAc,CACzCS,cAAc,EAAEC,OAAO,EACvBJ,MACD,CAAC;EAED,MAAMM,kBAAkB,GAAGb,OAAO,CACjC,MACCO,MAAM,CAACO,KAAK,CACX,CAAE;IAAEC;EAAK,CAAC,KACTA,IAAI,KAAK,sBAAsB,IAC/BA,IAAI,KAAK,yBAAyB,IAClCA,IAAI,KAAK,gBACX,CAAC,EACF,CAAER,MAAM,CACT,CAAC;;EAED;EACA;EACA,MAAMS,UAAU,GAAGnB,UAAU,CAAEJ,QAAQ,CAACwB,OAAQ,CAAC;EAEjD,MAAMC,gBAAgB,GAAG1B,mBAAmB,CAC3C;IACC2B,SAAS,EAAE;EACZ,CAAC,EACD;IACCC,cAAc,EAAEX,YAAY,GAAGY,SAAS,GAAG,KAAK;IAChDC,aAAa,EAAEnB,cAAc;IAC7BoB,YAAY,EAAErB,aAAa;IAC3BsB,YAAY,EAAEX;EACf,CACD,CAAC;EAED,MAAM;IAAEY,QAAQ;IAAEC;EAA8B,CAAC,GAAG9B,SAAS,CAC1D+B,MAAM,IAAM;IACb,IAAKX,UAAU,EAAG;MACjB,OAAOX,YAAY;IACpB;IAEA,MAAM;MAAEuB,qBAAqB;MAAEC;IAAqB,CAAC,GACpDF,MAAM,CAAEhC,SAAU,CAAC;IAEpB,OAAO;MACN8B,QAAQ,EAAEI,oBAAoB,CAAE,UAAU,EAAE,eAAgB,CAAC;MAC7DH,6BAA6B,EAAEE,qBAAqB,CACnD,kBAAkB,EAClBxB,4BACD;IACD,CAAC;EACF,CAAC,EACD,CAAEY,UAAU,CACb,CAAC;;EAED;EACAlB,SAAS,CAAE,MAAM;IAChB;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA,IACCkB,UAAU,IACVS,QAAQ,IACR,CAAEC,6BAA6B,IAC/B,CAAEjB,YAAY,IACd,CAAEG,mBAAmB,EACpB;MACD;IACD;IAEAJ,oBAAoB,CAAE,IAAI,EAAED,MAAO,CAAC;EACrC,CAAC,EAAE,CACFA,MAAM,EACNC,oBAAoB,EACpBQ,UAAU,EACVS,QAAQ,EACRC,6BAA6B,EAC7Bd,mBAAmB,EACnBH,YAAY,CACX,CAAC;EAEH,MAAMqB,OAAO,GAAGL,QAAQ,GAAGhC,QAAQ,GAAG,KAAK;EAE3C,OAAOsC,aAAA,CAACD,OAAO;IAAA,GAAMZ;EAAgB,CAAI,CAAC;AAC3C"}