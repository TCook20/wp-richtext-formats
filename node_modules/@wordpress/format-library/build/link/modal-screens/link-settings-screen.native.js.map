{"version":3,"names":["_element","require","_native","_i18n","_url","_components","_richText","_icons","_utils","_screens","_interopRequireDefault","_modal","LinkSettingsScreen","onRemove","onClose","onChange","speak","value","isActive","activeAttributes","isVisible","text","setText","useState","getTextContent","slice","opensInNewWindow","setOpensInNewWindows","target","linkValues","setLinkValues","isActiveLink","isRemovingLink","shouldEnableBottomSheetMaxHeight","onHandleClosingBottomSheet","listProps","useContext","BottomSheetContext","navigation","useNavigation","route","useRoute","inputValue","url","params","onLinkCellPressed","navigate","linkSettingsScreens","picker","useEffect","submit","skipStateUpdates","submitLink","shouldCloseBottomSheet","removeLink","clearFormat","activeFormats","prependHTTP","linkText","format","createLinkFormat","newAttributes","isCollapsed","toInsert","applyFormat","create","length","insert","start","end","textLength","needsSelectionUpdate","isValidHref","__","submitValue","unsubscribe","addListener","useMemo","shouldShowLinkOptions","createElement","Fragment","BottomSheet","LinkCell","onPress","Cell","icon","textColor","label","placeholder","onChangeValue","onSubmit","separatorType","undefined","SwitchCell","external","onValueChange","labelStyle","styles","clearLinkButton","safeAreaBottomInset","_default","exports","default"],"sources":["@wordpress/format-library/src/link/modal-screens/link-settings-screen.native.js"],"sourcesContent":["/**\n * External dependencies\n */\nimport { useNavigation, useRoute } from '@react-navigation/native';\n\n/**\n * WordPress dependencies\n */\nimport { __ } from '@wordpress/i18n';\nimport { useState, useContext, useEffect, useMemo } from '@wordpress/element';\nimport { prependHTTP } from '@wordpress/url';\nimport { BottomSheet, BottomSheetContext } from '@wordpress/components';\nimport {\n\tcreate,\n\tinsert,\n\tisCollapsed,\n\tapplyFormat,\n\tgetTextContent,\n\tslice,\n} from '@wordpress/rich-text';\nimport { external, textColor } from '@wordpress/icons';\n\n/**\n * Internal dependencies\n */\nimport { createLinkFormat, isValidHref } from '../utils';\nimport linkSettingsScreens from './screens';\n\nimport styles from '../modal.scss';\n\nconst LinkSettingsScreen = ( {\n\tonRemove,\n\tonClose,\n\tonChange,\n\tspeak,\n\tvalue,\n\tisActive,\n\tactiveAttributes,\n\tisVisible,\n} ) => {\n\tconst [ text, setText ] = useState( getTextContent( slice( value ) ) );\n\tconst [ opensInNewWindow, setOpensInNewWindows ] = useState(\n\t\tactiveAttributes.target === '_blank'\n\t);\n\tconst [ linkValues, setLinkValues ] = useState( {\n\t\tisActiveLink: isActive,\n\t\tisRemovingLink: false,\n\t} );\n\n\tconst {\n\t\tshouldEnableBottomSheetMaxHeight,\n\t\tonHandleClosingBottomSheet,\n\t\tlistProps,\n\t} = useContext( BottomSheetContext );\n\n\tconst navigation = useNavigation();\n\tconst route = useRoute();\n\tconst { inputValue = activeAttributes.url || '' } = route.params || {};\n\tconst onLinkCellPressed = () => {\n\t\tshouldEnableBottomSheetMaxHeight( false );\n\t\tnavigation.navigate( linkSettingsScreens.picker, { inputValue } );\n\t};\n\tuseEffect( () => {\n\t\tonHandleClosingBottomSheet( () => {\n\t\t\tsubmit( inputValue, { skipStateUpdates: true } );\n\t\t} );\n\t}, [ inputValue, opensInNewWindow, text ] );\n\n\tuseEffect( () => {\n\t\tconst { isActiveLink, isRemovingLink } = linkValues;\n\t\tif ( !! inputValue && ! isActiveLink && isVisible ) {\n\t\t\tsubmitLink( { shouldCloseBottomSheet: false } );\n\t\t} else if (\n\t\t\t( ( inputValue === '' && isActiveLink ) || isRemovingLink ) &&\n\t\t\tisVisible\n\t\t) {\n\t\t\tremoveLink( { shouldCloseBottomSheet: false } );\n\t\t}\n\t}, [\n\t\tinputValue,\n\t\tisVisible,\n\t\tlinkValues.isActiveLink,\n\t\tlinkValues.isRemovingLink,\n\t] );\n\n\tconst clearFormat = ( { skipStateUpdates = false } = {} ) => {\n\t\tonChange( { ...value, activeFormats: [] } );\n\t\tif ( ! skipStateUpdates ) {\n\t\t\tsetLinkValues( { isActiveLink: false, isRemovingLink: true } );\n\t\t}\n\t};\n\n\tconst submitLink = ( {\n\t\tshouldCloseBottomSheet = true,\n\t\tskipStateUpdates = false,\n\t} = {} ) => {\n\t\tconst url = prependHTTP( inputValue );\n\t\tconst linkText = text || inputValue;\n\t\tconst format = createLinkFormat( {\n\t\t\turl,\n\t\t\topensInNewWindow,\n\t\t\ttext: linkText,\n\t\t} );\n\t\tlet newAttributes;\n\t\tif ( isCollapsed( value ) && ! isActive ) {\n\t\t\t// Insert link.\n\t\t\tconst toInsert = applyFormat(\n\t\t\t\tcreate( { text: linkText } ),\n\t\t\t\tformat,\n\t\t\t\t0,\n\t\t\t\tlinkText.length\n\t\t\t);\n\t\t\tnewAttributes = insert( value, toInsert );\n\t\t} else if ( text !== getTextContent( slice( value ) ) ) {\n\t\t\t// Edit text in selected link.\n\t\t\tconst toInsert = applyFormat(\n\t\t\t\tcreate( { text } ),\n\t\t\t\tformat,\n\t\t\t\t0,\n\t\t\t\ttext.length\n\t\t\t);\n\t\t\tnewAttributes = insert( value, toInsert, value.start, value.end );\n\t\t} else {\n\t\t\t// Transform selected text into link.\n\t\t\tnewAttributes = applyFormat( value, format );\n\t\t}\n\t\t// Move selection to end of link.\n\t\tconst textLength = newAttributes.text.length;\n\t\t// check for zero width spaces\n\t\tif ( newAttributes.end > textLength ) {\n\t\t\tnewAttributes.start = textLength;\n\t\t\tnewAttributes.end = textLength;\n\t\t} else {\n\t\t\tnewAttributes.start = newAttributes.end;\n\t\t}\n\t\tnewAttributes.activeFormats = [];\n\t\tonChange( { ...newAttributes, needsSelectionUpdate: true } );\n\t\tif ( ! skipStateUpdates ) {\n\t\t\tsetLinkValues( { isActiveLink: true, isRemovingLink: false } );\n\t\t}\n\n\t\tif ( ! isValidHref( url ) ) {\n\t\t\tspeak(\n\t\t\t\t__(\n\t\t\t\t\t'Warning: the link has been inserted but may have errors. Please test it.'\n\t\t\t\t),\n\t\t\t\t'assertive'\n\t\t\t);\n\t\t} else if ( isActive ) {\n\t\t\tspeak( __( 'Link edited.' ), 'assertive' );\n\t\t} else {\n\t\t\tspeak( __( 'Link inserted' ), 'assertive' );\n\t\t}\n\n\t\tif ( shouldCloseBottomSheet ) {\n\t\t\tonClose();\n\t\t}\n\t};\n\n\tconst removeLink = ( {\n\t\tshouldCloseBottomSheet = true,\n\t\tskipStateUpdates = false,\n\t} = {} ) => {\n\t\tclearFormat( { skipStateUpdates } );\n\t\tonRemove();\n\t\tif ( shouldCloseBottomSheet ) {\n\t\t\tonClose();\n\t\t}\n\t};\n\n\tconst submit = ( submitValue, { skipStateUpdates = false } = {} ) => {\n\t\tif ( submitValue === '' ) {\n\t\t\tremoveLink( { skipStateUpdates } );\n\t\t} else {\n\t\t\tsubmitLink( { skipStateUpdates } );\n\t\t}\n\t};\n\n\tuseEffect( () => {\n\t\tconst unsubscribe = navigation.addListener( 'focus', () => {\n\t\t\tconst { params = {} } = route;\n\t\t\tif ( ! text && params.text ) {\n\t\t\t\tsetText( params.text );\n\t\t\t}\n\t\t} );\n\t\treturn unsubscribe;\n\t}, [ navigation, route.params?.text, text ] );\n\n\treturn useMemo( () => {\n\t\tconst shouldShowLinkOptions = !! inputValue;\n\n\t\treturn (\n\t\t\t<>\n\t\t\t\t<BottomSheet.LinkCell\n\t\t\t\t\tvalue={ inputValue }\n\t\t\t\t\tonPress={ onLinkCellPressed }\n\t\t\t\t/>\n\t\t\t\t<BottomSheet.Cell\n\t\t\t\t\ticon={ textColor }\n\t\t\t\t\tlabel={ __( 'Link text' ) }\n\t\t\t\t\tvalue={ text }\n\t\t\t\t\tplaceholder={ __( 'Add link text' ) }\n\t\t\t\t\tonChangeValue={ setText }\n\t\t\t\t\tonSubmit={ submit }\n\t\t\t\t\tseparatorType={ shouldShowLinkOptions ? undefined : 'none' }\n\t\t\t\t/>\n\t\t\t\t{ shouldShowLinkOptions && (\n\t\t\t\t\t<>\n\t\t\t\t\t\t<BottomSheet.SwitchCell\n\t\t\t\t\t\t\ticon={ external }\n\t\t\t\t\t\t\tlabel={ __( 'Open in new tab' ) }\n\t\t\t\t\t\t\tvalue={ opensInNewWindow }\n\t\t\t\t\t\t\tonValueChange={ setOpensInNewWindows }\n\t\t\t\t\t\t\tseparatorType={ 'fullWidth' }\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<BottomSheet.Cell\n\t\t\t\t\t\t\tlabel={ __( 'Remove link' ) }\n\t\t\t\t\t\t\tlabelStyle={ styles.clearLinkButton }\n\t\t\t\t\t\t\tseparatorType={ 'none' }\n\t\t\t\t\t\t\tonPress={ removeLink }\n\t\t\t\t\t\t/>\n\t\t\t\t\t</>\n\t\t\t\t) }\n\t\t\t</>\n\t\t);\n\t}, [ inputValue, text, opensInNewWindow, listProps.safeAreaBottomInset ] );\n};\n\nexport default LinkSettingsScreen;\n"],"mappings":"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"}