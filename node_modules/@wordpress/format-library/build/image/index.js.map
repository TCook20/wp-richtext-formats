{"version":3,"names":["_element","require","_components","_i18n","_richText","_blockEditor","_icons","ALLOWED_MEDIA_TYPES","name","title","__","image","keywords","object","tagName","className","attributes","style","url","alt","edit","Edit","exports","InlineUI","value","onChange","activeObjectAttributes","contentRef","width","setWidth","useState","replace","popoverAnchor","useAnchor","editableContentElement","current","settings","createElement","Popover","placement","focusOnMount","anchor","onSubmit","event","newReplacements","replacements","slice","start","type","preventDefault","__experimentalHStack","alignment","spacing","__experimentalNumberControl","label","min","newWidth","Button","icon","keyboardReturn","onFocus","isObjectActive","isModalOpen","setIsModalOpen","openModal","closeModal","MediaUploadCheck","RichTextToolbarButton","SVG","xmlns","viewBox","Path","d","onClick","isActive","MediaUpload","allowedTypes","onSelect","id","imgWidth","insertObject","Math","onClose","render","open"],"sources":["@wordpress/format-library/src/image/index.js"],"sourcesContent":["/**\n * WordPress dependencies\n */\nimport {\n\tPath,\n\tSVG,\n\tPopover,\n\tButton,\n\t__experimentalNumberControl as NumberControl,\n\t__experimentalHStack as HStack,\n} from '@wordpress/components';\nimport { __ } from '@wordpress/i18n';\nimport { useState } from '@wordpress/element';\nimport { insertObject, useAnchor } from '@wordpress/rich-text';\nimport {\n\tMediaUpload,\n\tRichTextToolbarButton,\n\tMediaUploadCheck,\n} from '@wordpress/block-editor';\nimport { keyboardReturn } from '@wordpress/icons';\n\nconst ALLOWED_MEDIA_TYPES = [ 'image' ];\n\nconst name = 'core/image';\nconst title = __( 'Inline image' );\n\nexport const image = {\n\tname,\n\ttitle,\n\tkeywords: [ __( 'photo' ), __( 'media' ) ],\n\tobject: true,\n\ttagName: 'img',\n\tclassName: null,\n\tattributes: {\n\t\tclassName: 'class',\n\t\tstyle: 'style',\n\t\turl: 'src',\n\t\talt: 'alt',\n\t},\n\tedit: Edit,\n};\n\nfunction InlineUI( { value, onChange, activeObjectAttributes, contentRef } ) {\n\tconst { style } = activeObjectAttributes;\n\tconst [ width, setWidth ] = useState( style?.replace( /\\D/g, '' ) );\n\tconst popoverAnchor = useAnchor( {\n\t\teditableContentElement: contentRef.current,\n\t\tsettings: image,\n\t} );\n\n\treturn (\n\t\t<Popover\n\t\t\tplacement=\"bottom\"\n\t\t\tfocusOnMount={ false }\n\t\t\tanchor={ popoverAnchor }\n\t\t\tclassName=\"block-editor-format-toolbar__image-popover\"\n\t\t>\n\t\t\t<form\n\t\t\t\tclassName=\"block-editor-format-toolbar__image-container-content\"\n\t\t\t\tonSubmit={ ( event ) => {\n\t\t\t\t\tconst newReplacements = value.replacements.slice();\n\n\t\t\t\t\tnewReplacements[ value.start ] = {\n\t\t\t\t\t\ttype: name,\n\t\t\t\t\t\tattributes: {\n\t\t\t\t\t\t\t...activeObjectAttributes,\n\t\t\t\t\t\t\tstyle: width ? `width: ${ width }px;` : '',\n\t\t\t\t\t\t},\n\t\t\t\t\t};\n\n\t\t\t\t\tonChange( {\n\t\t\t\t\t\t...value,\n\t\t\t\t\t\treplacements: newReplacements,\n\t\t\t\t\t} );\n\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t} }\n\t\t\t>\n\t\t\t\t<HStack alignment=\"bottom\" spacing=\"0\">\n\t\t\t\t\t<NumberControl\n\t\t\t\t\t\tclassName=\"block-editor-format-toolbar__image-container-value\"\n\t\t\t\t\t\tlabel={ __( 'Width' ) }\n\t\t\t\t\t\tvalue={ width }\n\t\t\t\t\t\tmin={ 1 }\n\t\t\t\t\t\tonChange={ ( newWidth ) => setWidth( newWidth ) }\n\t\t\t\t\t/>\n\t\t\t\t\t<Button\n\t\t\t\t\t\tclassName=\"block-editor-format-toolbar__image-container-button\"\n\t\t\t\t\t\ticon={ keyboardReturn }\n\t\t\t\t\t\tlabel={ __( 'Apply' ) }\n\t\t\t\t\t\ttype=\"submit\"\n\t\t\t\t\t/>\n\t\t\t\t</HStack>\n\t\t\t</form>\n\t\t</Popover>\n\t);\n}\n\nfunction Edit( {\n\tvalue,\n\tonChange,\n\tonFocus,\n\tisObjectActive,\n\tactiveObjectAttributes,\n\tcontentRef,\n} ) {\n\tconst [ isModalOpen, setIsModalOpen ] = useState( false );\n\n\tfunction openModal() {\n\t\tsetIsModalOpen( true );\n\t}\n\n\tfunction closeModal() {\n\t\tsetIsModalOpen( false );\n\t}\n\n\treturn (\n\t\t<MediaUploadCheck>\n\t\t\t<RichTextToolbarButton\n\t\t\t\ticon={\n\t\t\t\t\t<SVG xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\">\n\t\t\t\t\t\t<Path d=\"M4 18.5h16V17H4v1.5zM16 13v1.5h4V13h-4zM5.1 15h7.8c.6 0 1.1-.5 1.1-1.1V6.1c0-.6-.5-1.1-1.1-1.1H5.1C4.5 5 4 5.5 4 6.1v7.8c0 .6.5 1.1 1.1 1.1zm.4-8.5h7V10l-1-1c-.3-.3-.8-.3-1 0l-1.6 1.5-1.2-.7c-.3-.2-.6-.2-.9 0l-1.3 1V6.5zm0 6.1l1.8-1.3 1.3.8c.3.2.7.2.9-.1l1.5-1.4 1.5 1.4v1.5h-7v-.9z\" />\n\t\t\t\t\t</SVG>\n\t\t\t\t}\n\t\t\t\ttitle={ title }\n\t\t\t\tonClick={ openModal }\n\t\t\t\tisActive={ isObjectActive }\n\t\t\t/>\n\t\t\t{ isModalOpen && (\n\t\t\t\t<MediaUpload\n\t\t\t\t\tallowedTypes={ ALLOWED_MEDIA_TYPES }\n\t\t\t\t\tonSelect={ ( { id, url, alt, width: imgWidth } ) => {\n\t\t\t\t\t\tcloseModal();\n\t\t\t\t\t\tonChange(\n\t\t\t\t\t\t\tinsertObject( value, {\n\t\t\t\t\t\t\t\ttype: name,\n\t\t\t\t\t\t\t\tattributes: {\n\t\t\t\t\t\t\t\t\tclassName: `wp-image-${ id }`,\n\t\t\t\t\t\t\t\t\tstyle: `width: ${ Math.min(\n\t\t\t\t\t\t\t\t\t\timgWidth,\n\t\t\t\t\t\t\t\t\t\t150\n\t\t\t\t\t\t\t\t\t) }px;`,\n\t\t\t\t\t\t\t\t\turl,\n\t\t\t\t\t\t\t\t\talt,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t} )\n\t\t\t\t\t\t);\n\t\t\t\t\t\tonFocus();\n\t\t\t\t\t} }\n\t\t\t\t\tonClose={ closeModal }\n\t\t\t\t\trender={ ( { open } ) => {\n\t\t\t\t\t\topen();\n\t\t\t\t\t\treturn null;\n\t\t\t\t\t} }\n\t\t\t\t/>\n\t\t\t) }\n\t\t\t{ isObjectActive && (\n\t\t\t\t<InlineUI\n\t\t\t\t\tvalue={ value }\n\t\t\t\t\tonChange={ onChange }\n\t\t\t\t\tactiveObjectAttributes={ activeObjectAttributes }\n\t\t\t\t\tcontentRef={ contentRef }\n\t\t\t\t/>\n\t\t\t) }\n\t\t</MediaUploadCheck>\n\t);\n}\n"],"mappings":"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"}