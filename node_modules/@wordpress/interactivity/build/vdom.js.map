{"version":3,"names":["_preact","require","_constants","ignoreAttr","p","islandAttr","fullPrefix","directiveParser","RegExp","hydratedIslands","WeakSet","exports","toVdom","root","treeWalker","document","createTreeWalker","walk","node","attributes","nodeType","data","next","nextSibling","replaceWith","window","Text","nodeValue","remove","props","children","directives","hasDirectives","ignore","island","i","length","n","name","slice","val","value","JSON","parse","e","prefix","suffix","exec","h","localName","innerHTML","__directives","add","child","firstChild","vnode","nextChild","push","parentNode","currentNode"],"sources":["@wordpress/interactivity/src/vdom.js"],"sourcesContent":["/**\n * External dependencies\n */\nimport { h } from 'preact';\n/**\n * Internal dependencies\n */\nimport { directivePrefix as p } from './constants';\n\nconst ignoreAttr = `data-${ p }-ignore`;\nconst islandAttr = `data-${ p }-interactive`;\nconst fullPrefix = `data-${ p }-`;\n\n// Regular expression for directive parsing.\nconst directiveParser = new RegExp(\n\t`^data-${ p }-` + // ${p} must be a prefix string, like 'wp'.\n\t\t// Match alphanumeric characters including hyphen-separated\n\t\t// segments. It excludes underscore intentionally to prevent confusion.\n\t\t// E.g., \"custom-directive\".\n\t\t'([a-z0-9]+(?:-[a-z0-9]+)*)' +\n\t\t// (Optional) Match '--' followed by any alphanumeric charachters. It\n\t\t// excludes underscore intentionally to prevent confusion, but it can\n\t\t// contain multiple hyphens. E.g., \"--custom-prefix--with-more-info\".\n\t\t'(?:--([a-z0-9_-]+))?$',\n\t'i' // Case insensitive.\n);\n\nexport const hydratedIslands = new WeakSet();\n\n// Recursive function that transforms a DOM tree into vDOM.\nexport function toVdom( root ) {\n\tconst treeWalker = document.createTreeWalker(\n\t\troot,\n\t\t205 // ELEMENT + TEXT + COMMENT + CDATA_SECTION + PROCESSING_INSTRUCTION\n\t);\n\n\tfunction walk( node ) {\n\t\tconst { attributes, nodeType } = node;\n\n\t\tif ( nodeType === 3 ) return [ node.data ];\n\t\tif ( nodeType === 4 ) {\n\t\t\tconst next = treeWalker.nextSibling();\n\t\t\tnode.replaceWith( new window.Text( node.nodeValue ) );\n\t\t\treturn [ node.nodeValue, next ];\n\t\t}\n\t\tif ( nodeType === 8 || nodeType === 7 ) {\n\t\t\tconst next = treeWalker.nextSibling();\n\t\t\tnode.remove();\n\t\t\treturn [ null, next ];\n\t\t}\n\n\t\tconst props = {};\n\t\tconst children = [];\n\t\tconst directives = {};\n\t\tlet hasDirectives = false;\n\t\tlet ignore = false;\n\t\tlet island = false;\n\n\t\tfor ( let i = 0; i < attributes.length; i++ ) {\n\t\t\tconst n = attributes[ i ].name;\n\t\t\tif (\n\t\t\t\tn[ fullPrefix.length ] &&\n\t\t\t\tn.slice( 0, fullPrefix.length ) === fullPrefix\n\t\t\t) {\n\t\t\t\tif ( n === ignoreAttr ) {\n\t\t\t\t\tignore = true;\n\t\t\t\t} else if ( n === islandAttr ) {\n\t\t\t\t\tisland = true;\n\t\t\t\t} else {\n\t\t\t\t\thasDirectives = true;\n\t\t\t\t\tlet val = attributes[ i ].value;\n\t\t\t\t\ttry {\n\t\t\t\t\t\tval = JSON.parse( val );\n\t\t\t\t\t} catch ( e ) {}\n\t\t\t\t\tconst [ , prefix, suffix ] = directiveParser.exec( n );\n\t\t\t\t\tdirectives[ prefix ] = directives[ prefix ] || {};\n\t\t\t\t\tdirectives[ prefix ][ suffix || 'default' ] = val;\n\t\t\t\t}\n\t\t\t} else if ( n === 'ref' ) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tprops[ n ] = attributes[ i ].value;\n\t\t}\n\n\t\tif ( ignore && ! island )\n\t\t\treturn [\n\t\t\t\th( node.localName, {\n\t\t\t\t\t...props,\n\t\t\t\t\tinnerHTML: node.innerHTML,\n\t\t\t\t\t__directives: { ignore: true },\n\t\t\t\t} ),\n\t\t\t];\n\t\tif ( island ) hydratedIslands.add( node );\n\n\t\tif ( hasDirectives ) props.__directives = directives;\n\n\t\tlet child = treeWalker.firstChild();\n\t\tif ( child ) {\n\t\t\twhile ( child ) {\n\t\t\t\tconst [ vnode, nextChild ] = walk( child );\n\t\t\t\tif ( vnode ) children.push( vnode );\n\t\t\t\tchild = nextChild || treeWalker.nextSibling();\n\t\t\t}\n\t\t\ttreeWalker.parentNode();\n\t\t}\n\n\t\treturn [ h( node.localName, props, children ) ];\n\t}\n\n\treturn walk( treeWalker.currentNode );\n}\n"],"mappings":"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"}