{"version":3,"names":["deepSignal","isObject","item","Array","isArray","deepMerge","target","source","key","Object","assign","getSerializedState","storeTag","document","querySelector","state","JSON","parse","textContent","Error","e","console","log","afterLoads","Set","rawState","rawStore","store","block","afterLoad","add"],"sources":["@wordpress/interactivity/src/store.js"],"sourcesContent":["/**\n * External dependencies\n */\nimport { deepSignal } from 'deepsignal';\n\nconst isObject = ( item ) =>\n\titem && typeof item === 'object' && ! Array.isArray( item );\n\nconst deepMerge = ( target, source ) => {\n\tif ( isObject( target ) && isObject( source ) ) {\n\t\tfor ( const key in source ) {\n\t\t\tif ( isObject( source[ key ] ) ) {\n\t\t\t\tif ( ! target[ key ] ) Object.assign( target, { [ key ]: {} } );\n\t\t\t\tdeepMerge( target[ key ], source[ key ] );\n\t\t\t} else {\n\t\t\t\tObject.assign( target, { [ key ]: source[ key ] } );\n\t\t\t}\n\t\t}\n\t}\n};\n\nconst getSerializedState = () => {\n\tconst storeTag = document.querySelector(\n\t\t`script[type=\"application/json\"]#wp-interactivity-store-data`\n\t);\n\tif ( ! storeTag ) return {};\n\ttry {\n\t\tconst { state } = JSON.parse( storeTag.textContent );\n\t\tif ( isObject( state ) ) return state;\n\t\tthrow Error( 'Parsed state is not an object' );\n\t} catch ( e ) {\n\t\t// eslint-disable-next-line no-console\n\t\tconsole.log( e );\n\t}\n\treturn {};\n};\n\nexport const afterLoads = new Set();\n\nconst rawState = getSerializedState();\nexport const rawStore = { state: deepSignal( rawState ) };\n\n/**\n * @typedef StoreProps Properties object passed to `store`.\n * @property {Object} state State to be added to the global store. All the\n *                          properties included here become reactive.\n */\n\n/**\n * @typedef StoreOptions Options object.\n * @property {(store:any) => void} [afterLoad] Callback to be executed after the\n *                                             Interactivity API has been set up\n *                                             and the store is ready. It\n *                                             receives the store as argument.\n */\n\n/**\n * Extends the Interactivity API global store with the passed properties.\n *\n * These props typically consist of `state`, which is reactive, and other\n * properties like `selectors`, `actions`, `effects`, etc. which can store\n * callbacks and derived state. These props can then be referenced by any\n * directive to make the HTML interactive.\n *\n * @example\n * ```js\n *  store({\n *    state: {\n *      counter: { value: 0 },\n *    },\n *    actions: {\n *      counter: {\n *        increment: ({ state }) => {\n *          state.counter.value += 1;\n *        },\n *      },\n *    },\n *  });\n * ```\n *\n * The code from the example above allows blocks to subscribe and interact with\n * the store by using directives in the HTML, e.g.:\n *\n * ```html\n * <div data-wp-interactive>\n *   <button\n *     data-wp-text=\"state.counter.value\"\n *     data-wp-on--click=\"actions.counter.increment\"\n *   >\n *     0\n *   </button>\n * </div>\n * ```\n *\n * @param {StoreProps}   properties Properties to be added to the global store.\n * @param {StoreOptions} [options]  Options passed to the `store` call.\n */\nexport const store = ( { state, ...block }, { afterLoad } = {} ) => {\n\tdeepMerge( rawStore, block );\n\tdeepMerge( rawState, state );\n\tif ( afterLoad ) afterLoads.add( afterLoad );\n};\n"],"mappings":"AAAA;AACA;AACA;AACA,SAASA,UAAU,QAAQ,YAAY;AAEvC,MAAMC,QAAQ,GAAKC,IAAI,IACtBA,IAAI,IAAI,OAAOA,IAAI,KAAK,QAAQ,IAAI,CAAEC,KAAK,CAACC,OAAO,CAAEF,IAAK,CAAC;AAE5D,MAAMG,SAAS,GAAGA,CAAEC,MAAM,EAAEC,MAAM,KAAM;EACvC,IAAKN,QAAQ,CAAEK,MAAO,CAAC,IAAIL,QAAQ,CAAEM,MAAO,CAAC,EAAG;IAC/C,KAAM,MAAMC,GAAG,IAAID,MAAM,EAAG;MAC3B,IAAKN,QAAQ,CAAEM,MAAM,CAAEC,GAAG,CAAG,CAAC,EAAG;QAChC,IAAK,CAAEF,MAAM,CAAEE,GAAG,CAAE,EAAGC,MAAM,CAACC,MAAM,CAAEJ,MAAM,EAAE;UAAE,CAAEE,GAAG,GAAI,CAAC;QAAE,CAAE,CAAC;QAC/DH,SAAS,CAAEC,MAAM,CAAEE,GAAG,CAAE,EAAED,MAAM,CAAEC,GAAG,CAAG,CAAC;MAC1C,CAAC,MAAM;QACNC,MAAM,CAACC,MAAM,CAAEJ,MAAM,EAAE;UAAE,CAAEE,GAAG,GAAID,MAAM,CAAEC,GAAG;QAAG,CAAE,CAAC;MACpD;IACD;EACD;AACD,CAAC;AAED,MAAMG,kBAAkB,GAAGA,CAAA,KAAM;EAChC,MAAMC,QAAQ,GAAGC,QAAQ,CAACC,aAAa,CACrC,6DACF,CAAC;EACD,IAAK,CAAEF,QAAQ,EAAG,OAAO,CAAC,CAAC;EAC3B,IAAI;IACH,MAAM;MAAEG;IAAM,CAAC,GAAGC,IAAI,CAACC,KAAK,CAAEL,QAAQ,CAACM,WAAY,CAAC;IACpD,IAAKjB,QAAQ,CAAEc,KAAM,CAAC,EAAG,OAAOA,KAAK;IACrC,MAAMI,KAAK,CAAE,+BAAgC,CAAC;EAC/C,CAAC,CAAC,OAAQC,CAAC,EAAG;IACb;IACAC,OAAO,CAACC,GAAG,CAAEF,CAAE,CAAC;EACjB;EACA,OAAO,CAAC,CAAC;AACV,CAAC;AAED,OAAO,MAAMG,UAAU,GAAG,IAAIC,GAAG,CAAC,CAAC;AAEnC,MAAMC,QAAQ,GAAGd,kBAAkB,CAAC,CAAC;AACrC,OAAO,MAAMe,QAAQ,GAAG;EAAEX,KAAK,EAAEf,UAAU,CAAEyB,QAAS;AAAE,CAAC;;AAEzD;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO,MAAME,KAAK,GAAGA,CAAE;EAAEZ,KAAK;EAAE,GAAGa;AAAM,CAAC,EAAE;EAAEC;AAAU,CAAC,GAAG,CAAC,CAAC,KAAM;EACnExB,SAAS,CAAEqB,QAAQ,EAAEE,KAAM,CAAC;EAC5BvB,SAAS,CAAEoB,QAAQ,EAAEV,KAAM,CAAC;EAC5B,IAAKc,SAAS,EAAGN,UAAU,CAACO,GAAG,CAAED,SAAU,CAAC;AAC7C,CAAC"}