{"version":3,"names":["useEffect","effect","afterNextFrame","callback","Promise","resolve","done","clearTimeout","timeout","window","cancelAnimationFrame","raf","setTimeout","requestAnimationFrame","createFlusher","compute","notify","flush","dispose","c","bind","x","useSignalEffect","eff","isExecuting","createRootFragment","parent","replaceNode","concat","s","length","nextSibling","insert","r","insertBefore","__k","nodeType","parentNode","firstChild","childNodes","appendChild","removeChild"],"sources":["@wordpress/interactivity/src/utils.js"],"sourcesContent":["/**\n * External dependencies\n */\nimport { useEffect } from 'preact/hooks';\nimport { effect } from '@preact/signals';\n\nconst afterNextFrame = ( callback ) => {\n\treturn new Promise( ( resolve ) => {\n\t\tconst done = () => {\n\t\t\tclearTimeout( timeout );\n\t\t\twindow.cancelAnimationFrame( raf );\n\t\t\tsetTimeout( () => {\n\t\t\t\tcallback();\n\t\t\t\tresolve();\n\t\t\t} );\n\t\t};\n\t\tconst timeout = setTimeout( done, 100 );\n\t\tconst raf = window.requestAnimationFrame( done );\n\t} );\n};\n\n// Using the mangled properties:\n// this.c: this._callback\n// this.x: this._compute\n// https://github.com/preactjs/signals/blob/main/mangle.json\nfunction createFlusher( compute, notify ) {\n\tlet flush;\n\tconst dispose = effect( function () {\n\t\tflush = this.c.bind( this );\n\t\tthis.x = compute;\n\t\tthis.c = notify;\n\t\treturn compute();\n\t} );\n\treturn { flush, dispose };\n}\n\n// Version of `useSignalEffect` with a `useEffect`-like execution. This hook\n// implementation comes from this PR, but we added short-cirtuiting to avoid\n// infinite loops: https://github.com/preactjs/signals/pull/290\nexport function useSignalEffect( callback ) {\n\tuseEffect( () => {\n\t\tlet eff = null;\n\t\tlet isExecuting = false;\n\t\tconst notify = async () => {\n\t\t\tif ( eff && ! isExecuting ) {\n\t\t\t\tisExecuting = true;\n\t\t\t\tawait afterNextFrame( eff.flush );\n\t\t\t\tisExecuting = false;\n\t\t\t}\n\t\t};\n\t\teff = createFlusher( callback, notify );\n\t\treturn eff.dispose;\n\t}, [] );\n}\n\n// For wrapperless hydration.\n// See https://gist.github.com/developit/f4c67a2ede71dc2fab7f357f39cff28c\nexport const createRootFragment = ( parent, replaceNode ) => {\n\treplaceNode = [].concat( replaceNode );\n\tconst s = replaceNode[ replaceNode.length - 1 ].nextSibling;\n\tfunction insert( c, r ) {\n\t\tparent.insertBefore( c, r || s );\n\t}\n\treturn ( parent.__k = {\n\t\tnodeType: 1,\n\t\tparentNode: parent,\n\t\tfirstChild: replaceNode[ 0 ],\n\t\tchildNodes: replaceNode,\n\t\tinsertBefore: insert,\n\t\tappendChild: insert,\n\t\tremoveChild( c ) {\n\t\t\tparent.removeChild( c );\n\t\t},\n\t} );\n};\n"],"mappings":"AAAA;AACA;AACA;AACA,SAASA,SAAS,QAAQ,cAAc;AACxC,SAASC,MAAM,QAAQ,iBAAiB;AAExC,MAAMC,cAAc,GAAKC,QAAQ,IAAM;EACtC,OAAO,IAAIC,OAAO,CAAIC,OAAO,IAAM;IAClC,MAAMC,IAAI,GAAGA,CAAA,KAAM;MAClBC,YAAY,CAAEC,OAAQ,CAAC;MACvBC,MAAM,CAACC,oBAAoB,CAAEC,GAAI,CAAC;MAClCC,UAAU,CAAE,MAAM;QACjBT,QAAQ,CAAC,CAAC;QACVE,OAAO,CAAC,CAAC;MACV,CAAE,CAAC;IACJ,CAAC;IACD,MAAMG,OAAO,GAAGI,UAAU,CAAEN,IAAI,EAAE,GAAI,CAAC;IACvC,MAAMK,GAAG,GAAGF,MAAM,CAACI,qBAAqB,CAAEP,IAAK,CAAC;EACjD,CAAE,CAAC;AACJ,CAAC;;AAED;AACA;AACA;AACA;AACA,SAASQ,aAAaA,CAAEC,OAAO,EAAEC,MAAM,EAAG;EACzC,IAAIC,KAAK;EACT,MAAMC,OAAO,GAAGjB,MAAM,CAAE,YAAY;IACnCgB,KAAK,GAAG,IAAI,CAACE,CAAC,CAACC,IAAI,CAAE,IAAK,CAAC;IAC3B,IAAI,CAACC,CAAC,GAAGN,OAAO;IAChB,IAAI,CAACI,CAAC,GAAGH,MAAM;IACf,OAAOD,OAAO,CAAC,CAAC;EACjB,CAAE,CAAC;EACH,OAAO;IAAEE,KAAK;IAAEC;EAAQ,CAAC;AAC1B;;AAEA;AACA;AACA;AACA,OAAO,SAASI,eAAeA,CAAEnB,QAAQ,EAAG;EAC3CH,SAAS,CAAE,MAAM;IAChB,IAAIuB,GAAG,GAAG,IAAI;IACd,IAAIC,WAAW,GAAG,KAAK;IACvB,MAAMR,MAAM,GAAG,MAAAA,CAAA,KAAY;MAC1B,IAAKO,GAAG,IAAI,CAAEC,WAAW,EAAG;QAC3BA,WAAW,GAAG,IAAI;QAClB,MAAMtB,cAAc,CAAEqB,GAAG,CAACN,KAAM,CAAC;QACjCO,WAAW,GAAG,KAAK;MACpB;IACD,CAAC;IACDD,GAAG,GAAGT,aAAa,CAAEX,QAAQ,EAAEa,MAAO,CAAC;IACvC,OAAOO,GAAG,CAACL,OAAO;EACnB,CAAC,EAAE,EAAG,CAAC;AACR;;AAEA;AACA;AACA,OAAO,MAAMO,kBAAkB,GAAGA,CAAEC,MAAM,EAAEC,WAAW,KAAM;EAC5DA,WAAW,GAAG,EAAE,CAACC,MAAM,CAAED,WAAY,CAAC;EACtC,MAAME,CAAC,GAAGF,WAAW,CAAEA,WAAW,CAACG,MAAM,GAAG,CAAC,CAAE,CAACC,WAAW;EAC3D,SAASC,MAAMA,CAAEb,CAAC,EAAEc,CAAC,EAAG;IACvBP,MAAM,CAACQ,YAAY,CAAEf,CAAC,EAAEc,CAAC,IAAIJ,CAAE,CAAC;EACjC;EACA,OAASH,MAAM,CAACS,GAAG,GAAG;IACrBC,QAAQ,EAAE,CAAC;IACXC,UAAU,EAAEX,MAAM;IAClBY,UAAU,EAAEX,WAAW,CAAE,CAAC,CAAE;IAC5BY,UAAU,EAAEZ,WAAW;IACvBO,YAAY,EAAEF,MAAM;IACpBQ,WAAW,EAAER,MAAM;IACnBS,WAAWA,CAAEtB,CAAC,EAAG;MAChBO,MAAM,CAACe,WAAW,CAAEtB,CAAE,CAAC;IACxB;EACD,CAAC;AACF,CAAC"}