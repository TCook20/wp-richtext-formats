{"version":3,"names":["_element","require","_data","_blocks2","_blockEditor","_name","_privateApis","_entities","EMPTY_ARRAY","oldFootnotes","entityContexts","rootEntitiesConfig","reduce","acc","loader","kind","name","context","createContext","undefined","additionalEntityConfigLoaders","getEntityContext","Error","EntityProvider","type","id","children","Provider","createElement","value","useEntityId","useContext","useEntityProp","prop","_id","providerId","fullValue","useSelect","select","getEntityRecord","getEditedEntityRecord","STORE_NAME","record","editedRecord","editEntityRecord","useDispatch","setValue","useCallback","newValue","useEntityBlockEditor","content","editedBlocks","meta","blocks","__unstableCreateUndoLevel","useMemo","parse","updateFootnotes","_blocks","output","footnotes","getRichTextValues","unlock","blockEditorPrivateApis","_content","join","newOrder","indexOf","regex","match","exec","push","JSON","currentOrder","map","fn","newFootnotes","fnId","find","updateAttributes","attributes","Array","isArray","key","replace","opening","index","compatRegex","updateBlocksAttributes","__blocks","block","innerBlocks","newBlocks","includes","stringify","onChange","options","noChange","selection","edits","blocksForSerialization","__unstableSerializeAndClean","isCached","onInput","footnotesChanges"],"sources":["@wordpress/core-data/src/entity-provider.js"],"sourcesContent":["/**\n * WordPress dependencies\n */\nimport {\n\tcreateContext,\n\tuseContext,\n\tuseCallback,\n\tuseMemo,\n} from '@wordpress/element';\nimport { useSelect, useDispatch } from '@wordpress/data';\nimport { parse, __unstableSerializeAndClean } from '@wordpress/blocks';\nimport { privateApis as blockEditorPrivateApis } from '@wordpress/block-editor';\n\n/**\n * Internal dependencies\n */\nimport { STORE_NAME } from './name';\nimport { unlock } from './private-apis';\n\n/** @typedef {import('@wordpress/blocks').WPBlock} WPBlock */\n\nconst EMPTY_ARRAY = [];\n\nlet oldFootnotes = {};\n\n/**\n * Internal dependencies\n */\nimport { rootEntitiesConfig, additionalEntityConfigLoaders } from './entities';\n\nconst entityContexts = {\n\t...rootEntitiesConfig.reduce( ( acc, loader ) => {\n\t\tif ( ! acc[ loader.kind ] ) {\n\t\t\tacc[ loader.kind ] = {};\n\t\t}\n\t\tacc[ loader.kind ][ loader.name ] = {\n\t\t\tcontext: createContext( undefined ),\n\t\t};\n\t\treturn acc;\n\t}, {} ),\n\t...additionalEntityConfigLoaders.reduce( ( acc, loader ) => {\n\t\tacc[ loader.kind ] = {};\n\t\treturn acc;\n\t}, {} ),\n};\nconst getEntityContext = ( kind, name ) => {\n\tif ( ! entityContexts[ kind ] ) {\n\t\tthrow new Error( `Missing entity config for kind: ${ kind }.` );\n\t}\n\n\tif ( ! entityContexts[ kind ][ name ] ) {\n\t\tentityContexts[ kind ][ name ] = {\n\t\t\tcontext: createContext( undefined ),\n\t\t};\n\t}\n\n\treturn entityContexts[ kind ][ name ].context;\n};\n\n/**\n * Context provider component for providing\n * an entity for a specific entity.\n *\n * @param {Object} props          The component's props.\n * @param {string} props.kind     The entity kind.\n * @param {string} props.type     The entity name.\n * @param {number} props.id       The entity ID.\n * @param {*}      props.children The children to wrap.\n *\n * @return {Object} The provided children, wrapped with\n *                   the entity's context provider.\n */\nexport default function EntityProvider( { kind, type: name, id, children } ) {\n\tconst Provider = getEntityContext( kind, name ).Provider;\n\treturn <Provider value={ id }>{ children }</Provider>;\n}\n\n/**\n * Hook that returns the ID for the nearest\n * provided entity of the specified type.\n *\n * @param {string} kind The entity kind.\n * @param {string} name The entity name.\n */\nexport function useEntityId( kind, name ) {\n\treturn useContext( getEntityContext( kind, name ) );\n}\n\n/**\n * Hook that returns the value and a setter for the\n * specified property of the nearest provided\n * entity of the specified type.\n *\n * @param {string} kind  The entity kind.\n * @param {string} name  The entity name.\n * @param {string} prop  The property name.\n * @param {string} [_id] An entity ID to use instead of the context-provided one.\n *\n * @return {[*, Function, *]} An array where the first item is the\n *                            property value, the second is the\n *                            setter and the third is the full value\n * \t\t\t\t\t\t\t  object from REST API containing more\n * \t\t\t\t\t\t\t  information like `raw`, `rendered` and\n * \t\t\t\t\t\t\t  `protected` props.\n */\nexport function useEntityProp( kind, name, prop, _id ) {\n\tconst providerId = useEntityId( kind, name );\n\tconst id = _id ?? providerId;\n\n\tconst { value, fullValue } = useSelect(\n\t\t( select ) => {\n\t\t\tconst { getEntityRecord, getEditedEntityRecord } =\n\t\t\t\tselect( STORE_NAME );\n\t\t\tconst record = getEntityRecord( kind, name, id ); // Trigger resolver.\n\t\t\tconst editedRecord = getEditedEntityRecord( kind, name, id );\n\t\t\treturn record && editedRecord\n\t\t\t\t? {\n\t\t\t\t\t\tvalue: editedRecord[ prop ],\n\t\t\t\t\t\tfullValue: record[ prop ],\n\t\t\t\t  }\n\t\t\t\t: {};\n\t\t},\n\t\t[ kind, name, id, prop ]\n\t);\n\tconst { editEntityRecord } = useDispatch( STORE_NAME );\n\tconst setValue = useCallback(\n\t\t( newValue ) => {\n\t\t\teditEntityRecord( kind, name, id, {\n\t\t\t\t[ prop ]: newValue,\n\t\t\t} );\n\t\t},\n\t\t[ editEntityRecord, kind, name, id, prop ]\n\t);\n\n\treturn [ value, setValue, fullValue ];\n}\n\n/**\n * Hook that returns block content getters and setters for\n * the nearest provided entity of the specified type.\n *\n * The return value has the shape `[ blocks, onInput, onChange ]`.\n * `onInput` is for block changes that don't create undo levels\n * or dirty the post, non-persistent changes, and `onChange` is for\n * persistent changes. They map directly to the props of a\n * `BlockEditorProvider` and are intended to be used with it,\n * or similar components or hooks.\n *\n * @param {string} kind         The entity kind.\n * @param {string} name         The entity name.\n * @param {Object} options\n * @param {string} [options.id] An entity ID to use instead of the context-provided one.\n *\n * @return {[WPBlock[], Function, Function]} The block array and setters.\n */\nexport function useEntityBlockEditor( kind, name, { id: _id } = {} ) {\n\tconst providerId = useEntityId( kind, name );\n\tconst id = _id ?? providerId;\n\tconst { content, editedBlocks, meta } = useSelect(\n\t\t( select ) => {\n\t\t\tconst { getEditedEntityRecord } = select( STORE_NAME );\n\t\t\tconst editedRecord = getEditedEntityRecord( kind, name, id );\n\t\t\treturn {\n\t\t\t\teditedBlocks: editedRecord.blocks,\n\t\t\t\tcontent: editedRecord.content,\n\t\t\t\tmeta: editedRecord.meta,\n\t\t\t};\n\t\t},\n\t\t[ kind, name, id ]\n\t);\n\tconst { __unstableCreateUndoLevel, editEntityRecord } =\n\t\tuseDispatch( STORE_NAME );\n\n\tconst blocks = useMemo( () => {\n\t\tif ( editedBlocks ) {\n\t\t\treturn editedBlocks;\n\t\t}\n\n\t\treturn content && typeof content !== 'function'\n\t\t\t? parse( content )\n\t\t\t: EMPTY_ARRAY;\n\t}, [ editedBlocks, content ] );\n\n\tconst updateFootnotes = useCallback(\n\t\t( _blocks ) => {\n\t\t\tconst output = { blocks: _blocks };\n\t\t\tif ( ! meta ) return output;\n\t\t\t// If meta.footnotes is empty, it means the meta is not registered.\n\t\t\tif ( meta.footnotes === undefined ) return output;\n\n\t\t\tconst { getRichTextValues } = unlock( blockEditorPrivateApis );\n\t\t\tconst _content = getRichTextValues( _blocks ).join( '' ) || '';\n\t\t\tconst newOrder = [];\n\n\t\t\t// This can be avoided when\n\t\t\t// https://github.com/WordPress/gutenberg/pull/43204 lands. We can then\n\t\t\t// get the order directly from the rich text values.\n\t\t\tif ( _content.indexOf( 'data-fn' ) !== -1 ) {\n\t\t\t\tconst regex = /data-fn=\"([^\"]+)\"/g;\n\t\t\t\tlet match;\n\t\t\t\twhile ( ( match = regex.exec( _content ) ) !== null ) {\n\t\t\t\t\tnewOrder.push( match[ 1 ] );\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst footnotes = meta.footnotes\n\t\t\t\t? JSON.parse( meta.footnotes )\n\t\t\t\t: [];\n\t\t\tconst currentOrder = footnotes.map( ( fn ) => fn.id );\n\n\t\t\tif ( currentOrder.join( '' ) === newOrder.join( '' ) )\n\t\t\t\treturn output;\n\n\t\t\tconst newFootnotes = newOrder.map(\n\t\t\t\t( fnId ) =>\n\t\t\t\t\tfootnotes.find( ( fn ) => fn.id === fnId ) ||\n\t\t\t\t\toldFootnotes[ fnId ] || {\n\t\t\t\t\t\tid: fnId,\n\t\t\t\t\t\tcontent: '',\n\t\t\t\t\t}\n\t\t\t);\n\n\t\t\tfunction updateAttributes( attributes ) {\n\t\t\t\t// Only attempt to update attributes, if attributes is an object.\n\t\t\t\tif (\n\t\t\t\t\t! attributes ||\n\t\t\t\t\tArray.isArray( attributes ) ||\n\t\t\t\t\ttypeof attributes !== 'object'\n\t\t\t\t) {\n\t\t\t\t\treturn attributes;\n\t\t\t\t}\n\n\t\t\t\tattributes = { ...attributes };\n\n\t\t\t\tfor ( const key in attributes ) {\n\t\t\t\t\tconst value = attributes[ key ];\n\n\t\t\t\t\tif ( Array.isArray( value ) ) {\n\t\t\t\t\t\tattributes[ key ] = value.map( updateAttributes );\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( typeof value !== 'string' ) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( value.indexOf( 'data-fn' ) === -1 ) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\t// When we store rich text values, this would no longer\n\t\t\t\t\t// require a regex.\n\t\t\t\t\tconst regex =\n\t\t\t\t\t\t/(<sup[^>]+data-fn=\"([^\"]+)\"[^>]*><a[^>]*>)[\\d*]*<\\/a><\\/sup>/g;\n\n\t\t\t\t\tattributes[ key ] = value.replace(\n\t\t\t\t\t\tregex,\n\t\t\t\t\t\t( match, opening, fnId ) => {\n\t\t\t\t\t\t\tconst index = newOrder.indexOf( fnId );\n\t\t\t\t\t\t\treturn `${ opening }${ index + 1 }</a></sup>`;\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\n\t\t\t\t\tconst compatRegex =\n\t\t\t\t\t\t/<a[^>]+data-fn=\"([^\"]+)\"[^>]*>\\*<\\/a>/g;\n\n\t\t\t\t\tattributes[ key ] = attributes[ key ].replace(\n\t\t\t\t\t\tcompatRegex,\n\t\t\t\t\t\t( match, fnId ) => {\n\t\t\t\t\t\t\tconst index = newOrder.indexOf( fnId );\n\t\t\t\t\t\t\treturn `<sup data-fn=\"${ fnId }\" class=\"fn\"><a href=\"#${ fnId }\" id=\"${ fnId }-link\">${\n\t\t\t\t\t\t\t\tindex + 1\n\t\t\t\t\t\t\t}</a></sup>`;\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\treturn attributes;\n\t\t\t}\n\n\t\t\tfunction updateBlocksAttributes( __blocks ) {\n\t\t\t\treturn __blocks.map( ( block ) => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\t...block,\n\t\t\t\t\t\tattributes: updateAttributes( block.attributes ),\n\t\t\t\t\t\tinnerBlocks: updateBlocksAttributes(\n\t\t\t\t\t\t\tblock.innerBlocks\n\t\t\t\t\t\t),\n\t\t\t\t\t};\n\t\t\t\t} );\n\t\t\t}\n\n\t\t\t// We need to go through all block attributes deeply and update the\n\t\t\t// footnote anchor numbering (textContent) to match the new order.\n\t\t\tconst newBlocks = updateBlocksAttributes( _blocks );\n\n\t\t\toldFootnotes = {\n\t\t\t\t...oldFootnotes,\n\t\t\t\t...footnotes.reduce( ( acc, fn ) => {\n\t\t\t\t\tif ( ! newOrder.includes( fn.id ) ) {\n\t\t\t\t\t\tacc[ fn.id ] = fn;\n\t\t\t\t\t}\n\t\t\t\t\treturn acc;\n\t\t\t\t}, {} ),\n\t\t\t};\n\n\t\t\treturn {\n\t\t\t\tmeta: {\n\t\t\t\t\t...meta,\n\t\t\t\t\tfootnotes: JSON.stringify( newFootnotes ),\n\t\t\t\t},\n\t\t\t\tblocks: newBlocks,\n\t\t\t};\n\t\t},\n\t\t[ meta ]\n\t);\n\n\tconst onChange = useCallback(\n\t\t( newBlocks, options ) => {\n\t\t\tconst noChange = blocks === newBlocks;\n\t\t\tif ( noChange ) {\n\t\t\t\treturn __unstableCreateUndoLevel( kind, name, id );\n\t\t\t}\n\t\t\tconst { selection } = options;\n\n\t\t\t// We create a new function here on every persistent edit\n\t\t\t// to make sure the edit makes the post dirty and creates\n\t\t\t// a new undo level.\n\t\t\tconst edits = {\n\t\t\t\tselection,\n\t\t\t\tcontent: ( { blocks: blocksForSerialization = [] } ) =>\n\t\t\t\t\t__unstableSerializeAndClean( blocksForSerialization ),\n\t\t\t\t...updateFootnotes( newBlocks ),\n\t\t\t};\n\n\t\t\teditEntityRecord( kind, name, id, edits, { isCached: false } );\n\t\t},\n\t\t[\n\t\t\tkind,\n\t\t\tname,\n\t\t\tid,\n\t\t\tblocks,\n\t\t\tupdateFootnotes,\n\t\t\t__unstableCreateUndoLevel,\n\t\t\teditEntityRecord,\n\t\t]\n\t);\n\n\tconst onInput = useCallback(\n\t\t( newBlocks, options ) => {\n\t\t\tconst { selection } = options;\n\t\t\tconst footnotesChanges = updateFootnotes( newBlocks );\n\t\t\tconst edits = { selection, ...footnotesChanges };\n\n\t\t\teditEntityRecord( kind, name, id, edits, { isCached: true } );\n\t\t},\n\t\t[ kind, name, id, updateFootnotes, editEntityRecord ]\n\t);\n\n\treturn [ blocks, onInput, onChange ];\n}\n"],"mappings":"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"}