import { detect } from '../../../scripts/utils'
import { hide, show } from '../../../scripts/toggle'

// CSS for dropdowns
const primaryNavigationCSS = {
  nav_item_with_sub_list: 'miz-primary-navigation__nav-item-w-sub',
  show_content: 'show',
}

// Button data attribute
const dropdownButtonAttribute = 'data-miz-toggle-controls'

export default () => {
  // Locate all the dropdown containers in the document and store in a collection
  const primaryNavigationCollection = document.getElementsByClassName(
    primaryNavigationCSS.nav_item_with_sub_list,
  )

  for (let i = 0; i < primaryNavigationCollection.length; i += 1) {
    const dropdown = primaryNavigationCollection[i]
    const dropdownController = dropdown.querySelector(`[${dropdownButtonAttribute}]`)
    if (dropdownController !== null) {
      const dropdownContent = document.getElementById(dropdownController.dataset.mizToggleControls)
      const hideThis = () =>
        hide(dropdownController, dropdownContent, primaryNavigationCSS.show_content)

      dropdown.addEventListener('click', (e) => {
        if (dropdownController.contains(e.target)) {
          if (dropdownContent.classList.contains(primaryNavigationCSS.show_content)) {
            hideThis()
          } else {
            const containerWidth = dropdown.offsetWidth
            dropdownContent.style.width = `${containerWidth}px`

            show(dropdownController, dropdownContent, primaryNavigationCSS.show_content)
            detect(dropdown, dropdownController, hideThis)
          }
        }
      })
    }
  }
}
