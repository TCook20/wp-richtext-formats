import { detect } from './utils'
import { hide, show } from './toggle'

// CSS for expands
const expandCSS = {
  container: 'miz-expand',
  show_content: 'expand',
}

// Button data attribute
const expandButtonAttribute = 'data-miz-expand'

export default () => {
  // Locate all the expand containers in the document and store in a collection
  const expandCollection = document.getElementsByClassName(expandCSS.container)

  for (let i = 0; i < expandCollection.length; i += 1) {
    const expand = expandCollection[i]
    const toggleController = expand.querySelector(`[${expandButtonAttribute}]`)
    if (toggleController !== null) {
      const toggleContent = document.getElementById(toggleController.dataset.mizExpand)
      const hideThis = () => hide(toggleController, toggleContent, expandCSS.show_content)

      expand.addEventListener('click', (e) => {
        if (toggleController.contains(e.target)) {
          if (toggleContent.classList.contains('expand')) {
            hideThis()
          } else {
            show(toggleController, toggleContent, expandCSS.show_content)
            detect(expand, toggleController, hideThis)
          }
        }
      })
    }
  }
}
