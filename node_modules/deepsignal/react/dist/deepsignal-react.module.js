import"@preact/signals-react";import{useMemo as e}from"react";import{Signal as t,signal as r,computed as n}from"@preact/signals-core";var a=new WeakMap,o=new WeakMap,s=new WeakMap,c=new WeakSet,u=new WeakMap,i=/^\$/,f=!1,l=function(e){if(!d(e))throw new Error("This object can't be observed.");return o.has(e)||o.set(e,h(e,v)),o.get(e)},g=function(e,t){f=!0;var r=e[t];try{f=!1}catch(e){}return r},h=function(e,t){var r=new Proxy(e,t);return c.add(r),r},p=function(){throw new Error("Don't mutate the signals directly.")},y=function(e){return function(t,c,u){var l;if(f)return Reflect.get(t,c,u);var g=e||"$"===c[0];if(!e&&g&&Array.isArray(t)){if("$"===c)return s.has(t)||s.set(t,h(t,w)),s.get(t);g="$length"===c}a.has(u)||a.set(u,new Map);var p=a.get(u),y=g?c.replace(i,""):c;if(p.has(y)||"function"!=typeof(null==(l=Object.getOwnPropertyDescriptor(t,y))?void 0:l.get)){var b=Reflect.get(t,y,u);if(g&&"function"==typeof b)return;if("symbol"==typeof y&&m.has(y))return b;p.has(y)||(d(b)&&(o.has(b)||o.set(b,h(b,v)),b=o.get(b)),p.set(y,r(b)))}else p.set(y,n(function(){return Reflect.get(t,y,u)}));return g?p.get(y):p.get(y).value}},v={get:y(!1),set:function(e,n,s,c){a.has(c)||a.set(c,new Map);var f=a.get(c);if("$"===n[0]){s instanceof t||p();var l=n.replace(i,"");return f.set(l,s),Reflect.set(e,l,s.peek(),c)}var g=s;d(s)&&(o.has(s)||o.set(s,h(s,v)),g=o.get(s));var y=!(n in e),w=Reflect.set(e,n,s,c);return f.has(n)?f.get(n).value=g:f.set(n,r(g)),y&&u.has(e)&&u.get(e).value++,Array.isArray(e)&&f.has("length")&&(f.get("length").value=e.length),w},deleteProperty:function(e,t){"$"===t[0]&&p();var r=a.get(o.get(e)),n=Reflect.deleteProperty(e,t);return r&&r.has(t)&&(r.get(t).value=void 0),u.has(e)&&u.get(e).value++,n},ownKeys:function(e){return u.has(e)||u.set(e,r(0)),u._=u.get(e).value,Reflect.ownKeys(e)}},w={get:y(!0),set:p,deleteProperty:p},m=new Set(Object.getOwnPropertyNames(Symbol).map(function(e){return Symbol[e]}).filter(function(e){return"symbol"==typeof e})),b=new Set([Object,Array]),d=function(e){return"object"==typeof e&&null!==e&&(!("function"==typeof e.constructor&&e.constructor.name in globalThis&&globalThis[e.constructor.name]===e.constructor)||b.has(e.constructor))&&!c.has(e)},R=function(t){return e(function(){return l(t)},[])};export{l as deepSignal,g as peek,R as useDeepSignal};//# sourceMappingURL=deepsignal-react.module.js.map
