!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@preact/signals-core")):"function"==typeof define&&define.amd?define(["exports","@preact/signals-core"],t):t((e||self).deepsignalCore={},e.signalsCore)}(this,function(e,t){var n=new WeakMap,r=new WeakMap,a=new WeakMap,o=new WeakSet,s=new WeakMap,i=/^\$/,u=!1,c=function(e,t){var n=new Proxy(e,t);return o.add(n),n},l=function(){throw new Error("Don't mutate the signals directly.")},f=function(e){return function(o,s,l){var f;if(u)return Reflect.get(o,s,l);var y=e||"$"===s[0];if(!e&&y&&Array.isArray(o)){if("$"===s)return a.has(o)||a.set(o,c(o,p)),a.get(o);y="$length"===s}n.has(l)||n.set(l,new Map);var d=n.get(l),w=y?s.replace(i,""):s;if(d.has(w)||"function"!=typeof(null==(f=Object.getOwnPropertyDescriptor(o,w))?void 0:f.get)){var b=Reflect.get(o,w,l);if(y&&"function"==typeof b)return;if("symbol"==typeof w&&h.has(w))return b;d.has(w)||(v(b)&&(r.has(b)||r.set(b,c(b,g)),b=r.get(b)),d.set(w,t.signal(b)))}else d.set(w,t.computed(function(){return Reflect.get(o,w,l)}));return y?d.get(w):d.get(w).value}},g={get:f(!1),set:function(e,a,o,u){n.has(u)||n.set(u,new Map);var f=n.get(u);if("$"===a[0]){o instanceof t.Signal||l();var p=a.replace(i,"");return f.set(p,o),Reflect.set(e,p,o.peek(),u)}var h=o;v(o)&&(r.has(o)||r.set(o,c(o,g)),h=r.get(o));var y=!(a in e),d=Reflect.set(e,a,o,u);return f.has(a)?f.get(a).value=h:f.set(a,t.signal(h)),y&&s.has(e)&&s.get(e).value++,Array.isArray(e)&&f.has("length")&&(f.get("length").value=e.length),d},deleteProperty:function(e,t){"$"===t[0]&&l();var a=n.get(r.get(e)),o=Reflect.deleteProperty(e,t);return a&&a.has(t)&&(a.get(t).value=void 0),s.has(e)&&s.get(e).value++,o},ownKeys:function(e){return s.has(e)||s.set(e,t.signal(0)),s._=s.get(e).value,Reflect.ownKeys(e)}},p={get:f(!0),set:l,deleteProperty:l},h=new Set(Object.getOwnPropertyNames(Symbol).map(function(e){return Symbol[e]}).filter(function(e){return"symbol"==typeof e})),y=new Set([Object,Array]),v=function(e){return"object"==typeof e&&null!==e&&(!("function"==typeof e.constructor&&e.constructor.name in globalThis&&globalThis[e.constructor.name]===e.constructor)||y.has(e.constructor))&&!o.has(e)};e.deepSignal=function(e){if(!v(e))throw new Error("This object can't be observed.");return r.has(e)||r.set(e,c(e,g)),r.get(e)},e.peek=function(e,t){u=!0;var n=e[t];try{u=!1}catch(e){}return n}});//# sourceMappingURL=deepsignal-core.min.js.map
