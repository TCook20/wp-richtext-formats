import{Signal as e,signal as t,computed as r}from"@preact/signals-core";const s=new WeakMap,n=new WeakMap,o=new WeakMap,a=new WeakSet,c=new WeakMap,l=/^\$/;let g=!1;const u=e=>{if(!v(e))throw new Error("This object can't be observed.");return n.has(e)||n.set(e,f(e,y)),n.get(e)},h=(e,t)=>{g=!0;const r=e[t];try{g=!1}catch(e){}return r},f=(e,t)=>{const r=new Proxy(e,t);return a.add(r),r},i=()=>{throw new Error("Don't mutate the signals directly.")},p=e=>(a,c,u)=>{var h;if(g)return Reflect.get(a,c,u);let i=e||"$"===c[0];if(!e&&i&&Array.isArray(a)){if("$"===c)return o.has(a)||o.set(a,f(a,w)),o.get(a);i="$length"===c}s.has(u)||s.set(u,new Map);const p=s.get(u),m=i?c.replace(l,""):c;if(p.has(m)||"function"!=typeof(null==(h=Object.getOwnPropertyDescriptor(a,m))?void 0:h.get)){let e=Reflect.get(a,m,u);if(i&&"function"==typeof e)return;if("symbol"==typeof m&&b.has(m))return e;p.has(m)||(v(e)&&(n.has(e)||n.set(e,f(e,y)),e=n.get(e)),p.set(m,t(e)))}else p.set(m,r(()=>Reflect.get(a,m,u)));return i?p.get(m):p.get(m).value},y={get:p(!1),set(r,o,a,g){s.has(g)||s.set(g,new Map);const u=s.get(g);if("$"===o[0]){a instanceof e||i();const t=o.replace(l,"");return u.set(t,a),Reflect.set(r,t,a.peek(),g)}{let e=a;v(a)&&(n.has(a)||n.set(a,f(a,y)),e=n.get(a));const s=!(o in r),l=Reflect.set(r,o,a,g);return u.has(o)?u.get(o).value=e:u.set(o,t(e)),s&&c.has(r)&&c.get(r).value++,Array.isArray(r)&&u.has("length")&&(u.get("length").value=r.length),l}},deleteProperty(e,t){"$"===t[0]&&i();const r=s.get(n.get(e)),o=Reflect.deleteProperty(e,t);return r&&r.has(t)&&(r.get(t).value=void 0),c.has(e)&&c.get(e).value++,o},ownKeys:e=>(c.has(e)||c.set(e,t(0)),c._=c.get(e).value,Reflect.ownKeys(e))},w={get:p(!0),set:i,deleteProperty:i},b=new Set(Object.getOwnPropertyNames(Symbol).map(e=>Symbol[e]).filter(e=>"symbol"==typeof e)),m=new Set([Object,Array]),v=e=>"object"==typeof e&&null!==e&&(!("function"==typeof e.constructor&&e.constructor.name in globalThis&&globalThis[e.constructor.name]===e.constructor)||m.has(e.constructor))&&!a.has(e);export{u as deepSignal,h as peek};//# sourceMappingURL=deepsignal-core.mjs.map
